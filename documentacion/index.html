<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link rel="icon" href="./img/chatbot.png" type="image/png" />
    <title>Documentaci√≥n de ChatBot + IA</title>
    <link rel="stylesheet" href="css/styles.css" />
    <!-- Prism CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs-tomorrow-theme@0.0.1/prism-tomorrow.min.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="documentation-container">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
  <div class="logo">
    <img src="./img/chatbot.png" alt="chatbot" style="width: 30px; height: 30px">
    <span style="margin-left: 5px;">ChatBot + IA</span>
  </div>

  <nav class="main-nav">
    <ul>
      <!-- Secci√≥n: General -->
      <li class="active">
        <a href="#introduccion">
          <i class="fas fa-home"></i> Introducci√≥n
        </a>
      </li>

      <!-- Secci√≥n: Instalaci√≥n -->
      <li class="section-title">üõ† Instalaci√≥n</li>
      <li>
        <a href="#instalacion-configuracion">
          <i class="fas fa-cogs"></i> Instalaci√≥n y Configuraci√≥n
        </a>
      </li>
      

      <!-- Secci√≥n: C√≥digo -->
      <li class="section-title">üìÇ Documentaci√≥n del C√≥digo</li>
      <li>
        <a href="#estructura">
          <i class="fas fa-folder-open"></i> Estructura de Archivos
        </a>
      </li>
      <li>
        <a href="#env-guia">
          <i class="fa-solid fa-file-lines"></i> Variable de entorno (.env)
        </a>
      </li>
      
      <li>
        <a href="#php-guia">
          <i class="fa-brands fa-php"></i> Gu√≠a PHP
        </a>
      </li>
      <li>
        <a href="#html-guia">
          <i class="fas fa-code"></i> Gu√≠a HTML
        </a>
      </li>
      <li>
        <a href="#css-guia">
          <i class="fab fa-css3-alt"></i> Gu√≠a CSS
        </a>
      </li>
      <li>
        <a href="#js-guia">
          <i class="fab fa-js-square"></i> Gu√≠a JavaScript
        </a>
      </li>
      <li>
        <a href="#soporte">
          <i class="fas fa-life-ring"></i> Soporte
        </a>
      </li>
    </ul>
  </nav>

  <div class="version-selector">
    <label for="version"><i class="fas fa-tag"></i> Versi√≥n:</label>
    <select id="version">
      <option>1.0.0</option>
    </select>
  </div>
</aside>


      <!-- Main Content -->
      <main class="content">
        <section id="introduccion" class="doc-section">
          <h1>Documentaci√≥n de ChatBot + IA</h1>
          <p>
            Este manual describe c√≥mo configurar e implementar un chatbot con
            inteligencia artificial utilizando PHP y la API de OpenAI, incluyendo Deepseek y OpenRouter (o compatible). El sistema incluye funcionalidades
            avanzadas como cach√©, historial de conversaci√≥n y personalizaci√≥n
            basada en datos de la empresa.
          </p>
          <p>El chatbot es completamente adaptable y puede integrarse f√°cilmente en cualquier sitio web, mejorando la experiencia del usuario desde el primer clic.</p>

          <div class="requirements">
            <h2><i class="fas fa-tools"></i> Requisitos</h2>
            <ul>
              <li>Editor de c√≥digo (VS Code, Sublime Text, etc.).</li>
              <li>Navegador moderno (Chrome, Firefox, Edge).</li>
              <li>Conocimientos b√°sicos de HTML/CSS/JS/PHP.</li>
              <li>Servidor web con PHP 8.0 o superior.</li>
              <li>Extensi√≥n cURL habilitada.</li>
              <li>Recomendado: Extensi√≥n APCu para cach√© en memoria.</li>
              <li>Acceso a la API (clave API v√°lida).</li>
            </ul>
          </div>
        </section>

        <section id="instalacion-configuracion" class="doc-section">
  <h2><i class="fas fa-cogs"></i> Instalaci√≥n y Configuraci√≥n</h2>
  <p>
    Sigue estos pasos para integrar y configurar el ChatBot + IA en tu sitio web.
    La instalaci√≥n est√° dise√±ada para ser sencilla, permitiendo una r√°pida puesta en marcha.
  </p>

  <hr>

  <h3>Paso 1: Colocar la carpeta del Chatbot</h3>
  <p>
    El chatbot se distribuye en una carpeta llamada <code>/chatbot</code>. Para utilizarlo,
    simplemente copia esta carpeta completa y col√≥cala en el <strong>directorio ra√≠z</strong>
    de tu sitio web. Este es el mismo lugar donde generalmente se encuentra tu archivo
    <code>index.html</code> o la p√°gina principal de tu sitio.
  </p>
  <p>La estructura de tu proyecto deber√≠a verse similar a esto:</p>
  <pre><code class="language-plaintext">
/tu-sitio-web-raiz/
  ‚îú‚îÄ‚îÄ index.html (o tu p√°gina principal)
  ‚îú‚îÄ‚îÄ css/
  ‚îú‚îÄ‚îÄ js/
  ‚îú‚îÄ‚îÄ img/
  ‚îú‚îÄ‚îÄ chatbot/  <-- AQU√ç VA LA CARPETA DEL CHATBOT
  ‚îÇ     ‚îú‚îÄ‚îÄ cache/
  ‚îÇ           ‚îú‚îÄ‚îÄ company_data.cache
  ‚îÇ     ‚îú‚îÄ‚îÄ css/
  ‚îÇ           ‚îú‚îÄ‚îÄ chatbot.css
  ‚îÇ     ‚îú‚îÄ‚îÄ data/
  ‚îÇ           ‚îú‚îÄ‚îÄ company.json
  ‚îÇ     ‚îú‚îÄ‚îÄ img/
  ‚îÇ           ‚îú‚îÄ‚îÄ chatbot.png
  ‚îÇ     ‚îú‚îÄ‚îÄ js/
  ‚îÇ           ‚îú‚îÄ‚îÄ chatbot.js
  ‚îÇ     ‚îú‚îÄ‚îÄ .env
  ‚îÇ     ‚îú‚îÄ‚îÄ chatbot.php
  ‚îî‚îÄ‚îÄ ... (otros archivos y carpetas de tu sitio)
  </code></pre>
  <p>
    Aseg√∫rate de que las carpetas <code>/chatbot/data/</code> y <code>/chatbot/cache/</code> existan y tengan permisos de escritura si tu servidor lo requiere para que el script PHP pueda crear y modificar archivos dentro de ellas.
  </p>

  <hr>

  <h3>Paso 2: Integrar el HTML del Chatbot</h3>
  <p>
    Para que el chatbot est√© disponible en todas las secciones de tu sitio web,
    se recomienda incluir su c√≥digo HTML en el pie de p√°gina (<code>footer</code>)
    de tu plantilla principal o justo antes de la etiqueta de cierre <code>&lt;/body&gt;</code>
    en cada p√°gina donde desees que aparezca.
  </p>
  <p>Copia y pega el siguiente bloque de c√≥digo HTML:</p>
  <pre><code class="language-html">
&lt;!-- Componente Chatbot --&gt;
&lt;!-- Bot√≥n de invitaci√≥n inicial --&gt;
&lt;div id="chatbot-invite" class="chatbot-invite"&gt;
  &lt;span&gt;¬°Chatea con nosotros!&lt;/span&gt;
&lt;/div&gt;

&lt;!-- Bot√≥n para abrir/cerrar el chatbot --&gt;
&lt;div id="chatbot-toggle" class="chatbot-toggle"&gt;
  &lt;img
    src="./chatbot/img/chatbot.png"
    width="50"
    height="50"
    alt="Icono del asistente virtual"
    class="img-zoom"
  /&gt;
&lt;/div&gt;

&lt;!-- Contenedor principal del chatbot --&gt;
&lt;div id="chatbot-container" class="chatbot-container hidden"&gt;
  &lt;!-- Encabezado del chatbot --&gt;
  &lt;div class="chatbot-header"&gt;
    &lt;span style="display: inline-flex; align-items: center; gap: 8px"&gt;
      &lt;img
        src="./chatbot/img/chatbot.png"
        width="50"
        height="50"
        alt="Asistente Virtual"
        class="img-zoom"
      /&gt;
      &lt;span&gt;Tu Asistente Virtual&lt;/span&gt;
    &lt;/span&gt;
    &lt;button
      id="chatbot-close"
      class="chatbot-close"
      aria-label="Cerrar chatbot"
    &gt;
      &lt;i class="fa-solid fa-circle-xmark"&gt;&lt;/i&gt;
    &lt;/button&gt;
  &lt;/div&gt;

  &lt;!-- √Årea de mensajes --&gt;
  &lt;div id="chatbot-messages" class="chatbot-messages"&gt;
    &lt;!-- Los mensajes se insertan din√°micamente desde JavaScript --&gt;
  &lt;/div&gt;

  &lt;!-- Pie del chatbot con controles de entrada --&gt;
  &lt;div class="chatbot-footer"&gt;
    &lt;button class="clear-history-btn" title="Limpiar Historial"&gt;
      &lt;i class="fa-regular fa-trash-can"&gt;&lt;/i&gt;
    &lt;/button&gt;
    &lt;input
      type="text"
      id="chatbot-input-field"
      class="chatbot-input-field"
      placeholder="Escribe tu mensaje..."
      autofocus
      aria-label="Campo de entrada del chatbot"
    /&gt;
    &lt;button
      id="chatbot-send"
      class="chatbot-send"
      aria-label="Enviar mensaje"
    &gt;
      &lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt;
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;!-- Fin Componente Chatbot --&gt;
  </code></pre>
  <p class="nota-importante ">
     Aseg√∫rate de que las rutas a las im√°genes (ej. <code>src="./chatbot/img/chatbot.png"</code>)
    sean correctas desde la ubicaci√≥n de tus archivos HTML principales. Si tu archivo <code>index.html</code> est√° en la ra√≠z
    y la carpeta <code>chatbot</code> tambi√©n, estas rutas deber√≠an funcionar.
  </p>
  <p>
    No olvides enlazar los archivos CSS (<code>chatbot.css</code>) y JavaScript (<code>chatbot.js</code>) del chatbot en tu HTML,
    generalmente en la secci√≥n <code>&lt;head&gt;</code> para CSS y antes de cerrar <code>&lt;/body&gt;</code> para JS:
  </p>
  <pre><code class="language-html">
&lt;!-- En el &lt;head&gt; o antes de cerrar &lt;/body&gt; para CSS --&gt;
&lt;link rel="stylesheet" href="./chatbot/chatbot.css"&gt;

&lt;!-- Antes de cerrar &lt;/body&gt; para JavaScript --&gt;
&lt;script src="./chatbot/chatbot.js"&gt;&lt;/script&gt;
  </code></pre>

  <hr>

  <h3>Paso 3: Configurar el archivo de entorno (<code>.env</code>)</h3>
  <p>
    El chatbot utiliza un archivo <code>.env</code> para gestionar configuraciones sensibles y espec√≠ficas
    del entorno, como claves de API y rutas.
    <code>/chatbot/.env</code>.
  </p>
  <pre><code class="language-ini">
API_URL=https://api.openai.com/v1/chat/completions
API_KEY=tu_clave_api_aqui
MODEL=gpt-3.5-turbo
COMPANY_DATA_PATH=./data/company.json
MAX_TOKENS=1000
TEMPERATURE=0.7
CACHE_PATH=./cache/
COMPANY_CACHE_FILE=./cache/company_data.cache
CACHE_LIFETIME=3600
  </code></pre>
  <p><strong>Descripci√≥n de las variables:</strong></p>
  <ul>
    <li>
      <code>API_URL</code>: El endpoint de la API del modelo de lenguaje. (Ej: OpenAI).
    </li>
    <li>
      <code>API_KEY</code>: <strong>Importante:</strong> Reemplaza <code>tu_clave_api_aqui</code> con tu clave API real
      proporcionada por el servicio de IA (Ej: OpenAI).
    </li>
    <li>
      <code>MODEL</code>: El identificador del modelo de IA que deseas utilizar.
    </li>
    <li>
      <code>COMPANY_DATA_PATH</code>: Ruta relativa (desde el script PHP que lo lee, usualmente dentro de <code>/chatbot/</code>)
      al archivo JSON que contiene la informaci√≥n de tu empresa. Por defecto, <code>./data/company.json</code> se refiere a
      <code>/chatbot/data/company.json</code>.
    </li>
    <li>
      <code>MAX_TOKENS</code>: N√∫mero m√°ximo de tokens (palabras/subpalabras) que la IA generar√° en su respuesta.
    </li>
    <li>
      <code>TEMPERATURE</code>: Controla la "creatividad" o aleatoriedad de las respuestas de la IA.
      Valores m√°s bajos (ej. 0.2) generan respuestas m√°s deterministas y enfocadas, mientras que valores m√°s altos
      (ej. 0.8) generan respuestas m√°s creativas y diversas. <code>0.7</code> es un valor balanceado.
    </li>
    <li>
      <code>CACHE_PATH</code>: Ruta relativa al directorio donde se guardar√°n los archivos de cach√©.
      Por defecto, <code>./cache/</code> se refiere a <code>/chatbot/cache/</code>.
    </li>
    <li>
      <code>COMPANY_CACHE_FILE</code>: Ruta relativa al archivo de cach√© espec√≠fico para los datos de la empresa.
      Por defecto, <code>./cache/company_data.cache</code> se refiere a <code>/chatbot/cache/company_data.cache</code>.
    </li>
    <li>
      <code>CACHE_LIFETIME</code>: Tiempo de vida de la cach√© en segundos (ej. <code>3600</code> = 1 hora).
    </li>
  </ul>

  <p class="nota-importante ">
    <strong>¬°No compartas tu archivo <code>.env</code> p√∫blicamente ni lo subas a repositorios de c√≥digo p√∫blicos!</strong>
    Aseg√∫rate de que tu servidor web est√© configurado para denegar el acceso directo a los archivos <code>.env</code>.
    Si usas Git, a√±ade <code>.env</code> a tu archivo <code>.gitignore</code>.
  </p>

  <hr>

  <h3>Paso 4: Configurar el archivo de informaci√≥n de la empresa (<code>company.json</code>)</h3>
  <p>
    El chatbot est√° dise√±ado para responder preguntas basadas en la informaci√≥n espec√≠fica de tu empresa.
    Esta informaci√≥n se carga desde un archivo JSON.
  </p>
  <p>
    Crea un archivo llamado <code>company.json</code> dentro de la carpeta <code>/chatbot/data/</code>
    (la ruta por defecto es <code>./data/company.json</code> seg√∫n la configuraci√≥n del <code>.env</code>).
  </p>
  <p>El contenido de este archivo debe ser un objeto JSON estructurado con la informaci√≥n que deseas que la IA conozca. Aqu√≠ tienes un ejemplo b√°sico:</p>
  <pre><code class="language-json">
{
  "nombre_empresa": "Mi Gran Empresa S.A.",
  "descripcion_general": "Somos l√≠deres en soluciones innovadoras para el sector X, 
                          con m√°s de 20 a√±os de experiencia.",
  "horario_atencion": "Lunes a Viernes de 9:00 AM a 6:00 PM",
  "contacto": {
    "telefono": "+123 456 7890",
    "email": "info@migranempresa.com",
    "direccion": "Calle Falsa 123, Ciudad Ejemplo"
  },
  "productos_servicios": [
    {
      "nombre": "Producto Estrella Alfa",
      "descripcion": "Nuestra soluci√≥n m√°s popular para optimizar Y.",
      "precio": "Desde $99"
    },
    {
      "nombre": "Servicio Beta Premium",
      "descripcion": "Consultor√≠a experta y soporte 24/7 para Z.",
      "caracteristicas": ["Soporte prioritario", "Consultores dedicados", "Informes mensuales"]
    }
  ],
  "preguntas_frecuentes": [
    {
      "pregunta": "¬øC√≥mo puedo contratar sus servicios?",
      "respuesta": "Puedes contactarnos a trav√©s de nuestro email info@migranempresa.com o llamando 
                    al +123 456 7890. Tambi√©n puedes visitar nuestra secci√≥n de contacto en la web."
    },
    {
      "pregunta": "¬øOfrecen demostraciones?",
      "respuesta": "S√≠, ofrecemos demostraciones gratuitas de nuestro Producto Estrella Alfa. 
                    Por favor, agenda una cita con nuestro equipo de ventas."
    }
  ],
  "politica_devoluciones": "Puedes consultar nuestra pol√≠tica de devoluciones en www.example.com/devoluciones. 
                            Generalmente aceptamos devoluciones dentro de los 30 d√≠as posteriores a la compra, 
                            siempre que el producto est√© en su estado original."
}
  </code></pre>
  <p>
    Puedes estructurar este JSON como mejor te convenga. La IA intentar√° extraer la informaci√≥n relevante
    de este archivo para responder a las consultas de los usuarios relacionadas con tu empresa. Cuanto m√°s detallada
    y bien estructurada sea la informaci√≥n, mejores ser√°n las respuestas.
  </p>

  <hr>
  <p>
    Una vez completados estos pasos, tu chatbot deber√≠a estar listo para funcionar en tu sitio web.
    Dir√≠gete a las gu√≠as espec√≠ficas de PHP, HTML, CSS y JavaScript para entender mejor c√≥mo
    modificar y extender la funcionalidad del chatbot.
  </p>
</section>

        <section id="estructura" class="doc-section">
          <h2><i class="fas fa-folder-open"></i> Estructura de Archivos</h2>
          <p>La plantilla sigue una estructura organizada y modular:</p>

<pre><code class="language-plaintext">
/chatbot/
     ‚îú‚îÄ‚îÄ cache/
           ‚îú‚îÄ‚îÄ company_data.cache
     ‚îú‚îÄ‚îÄ css/
           ‚îú‚îÄ‚îÄ chatbot.css
     ‚îú‚îÄ‚îÄ data/
           ‚îú‚îÄ‚îÄ company.json
     ‚îú‚îÄ‚îÄ img/
           ‚îú‚îÄ‚îÄ chatbot.png
     ‚îú‚îÄ‚îÄ js/
           ‚îú‚îÄ‚îÄ chatbot.js
     ‚îú‚îÄ‚îÄ .env
     ‚îú‚îÄ‚îÄ chatbot.php
  </code></pre>

          <div class="file-description">
            <h3>Descripci√≥n de archivos</h3>
            <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%;">
              <thead>
                <tr>
                  <th>Archivo/Carpeta</th>
                  <th>Descripci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>cache/company_data.cache</code></td>
                  <td>
                    Archivo de cach√© que almacena datos de la empresa para
                    mejorar el rendimiento
                  </td>
                </tr>
                <tr>
                  <td><code>css/chatbot.css</code></td>
                  <td>
                    Archivo de hojas de estilo que define el dise√±o y apariencia
                    del chatbot
                  </td>
                </tr>
                <tr>
                  <td><code>js/chatbot.js</code></td>
                  <td>
                    L√≥gica principal del chatbot, incluyendo interacciones y
                    funcionalidades
                  </td>
                </tr>
                <tr>
                  <td><code>data/company.json</code></td>
                  <td>
                    Datos estructurados de la empresa en formato JSON que el
                    chatbot puede utilizar
                  </td>
                </tr>
                <tr>
                  <td><code>img/chatbot.png</code></td>
                  <td>Imagen o icono que representa visualmente al chatbot</td>
                </tr>
                <tr>
                  <td><code>.env</code></td>
                  <td><p>
                    Este archivo .env contiene las variables de entorno necesarias para la configuraci√≥n general del chatbot con inteligencia artificial. Estas variables permiten conectar con un modelo de lenguaje alojado en OpenAI, incluyendo Deepseek y OpenRouter (o compatible), define el comportamiento del modelo y gestiona el uso de cach√© y datos de la empresa.
                  </p></td>
                </tr>
                <tr>
                  <td><code>chatbot.php</code></td>
                  <td>
                    <p>
                      Archivo principal del backend del chatbot que maneja toda
                      la l√≥gica de comunicaci√≥n con la API de DeepSeek. Sus
                      funciones principales son:
                    </p>
                    <div style="margin-left:2rem">
                      <ul>
                      <li>
                        <strong>Configuraci√≥n:</strong> Define constantes como
                        API_URL, API_KEY, par√°metros del modelo (MAX_TOKENS,
                        TEMPERATURE)
                      </li>
                      <li>
                        <strong>Gesti√≥n de cach√©:</strong> Implementa sistema de
                        cach√© para datos de la empresa (APCu y archivos)
                      </li>
                      <li>
                        <strong>Conexi√≥n API:</strong> Incluye funci√≥n
                        <code>testAPIConnection()</code> para verificar
                        conectividad
                      </li>
                      <li>
                        <strong>Procesamiento de mensajes:</strong> Funci√≥n
                        <code>callAIModelAPI()</code> que construye el contexto
                        del chat
                      </li>
                      <li>
                        <strong>Manejo de sesiones:</strong> Mantiene historial
                        de conversaci√≥n en <code>$_SESSION</code>
                      </li>
                      <li>
                        <strong>Endpoints:</strong> Maneja peticiones para
                        enviar mensajes, cargar/borrar historial y limpiar cach√©
                      </li>
                      <li>
                        <strong>Seguridad:</strong> Validaci√≥n de entradas y
                        manejo de errores
                      </li>
                    </ul>
                    </div>
                    
                  </td>
                </tr>
                <tr>
                  <td><strong>Secciones clave:</strong></td>
                  <td>
                    <div style="margin-left:2rem">
                    <ol>
                      <li>
                        Configuraci√≥n de constantes y par√°metros del modelo
                      </li>
                      <li>
                        Funci√≥n <code>load_company_data()</code> con sistema
                        de cach√© de dos niveles
                      </li>
                      <li>
                        Funci√≥n <code>callAIModelAPI()</code> que construye el
                        contexto del chat incluyendo:
                        <ul style="margin-left: 20px;">
                          <li>Instrucciones del sistema</li>
                          <li>Datos de la empresa</li>
                          <li>Historial de conversaci√≥n</li>
                        </ul>
                      </li>
                      <li>
                        Manejo de peticiones POST para diferentes acciones del
                        chatbot
                      </li>
                      <li>
                        Sistema completo de manejo de errores y respuestas JSON
                      </li>
                    </ol>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Guia ENV -->
        <section id="env-guia" class="doc-section">
          <h2><i class="fa-solid fa-file-lines"></i> Variable de entorno</h2>
          <p style="color: #4361ee">/chatbot/.env</p>
            <p>Este archivo .env contiene las variables de entorno necesarias para la configuraci√≥n general del chatbot con inteligencia artificial. Estas variables permiten conectar con un modelo de lenguaje alojado en OpenRouter, definir el comportamiento del modelo y gestionar el uso de cach√© y datos de la empresa.</p>
          <h3>Configuraci√≥n del <code>.env</code></h3>
<pre>
<code class="language-php">
API_URL=https://api.openai.com/v1/chat/completions
API_KEY=
MODEL=gpt-3.5-turbo
COMPANY_DATA_PATH=./data/company.json
MAX_TOKENS=1000
TEMPERATURE=0.7
CACHE_PATH=./cache/
COMPANY_CACHE_FILE=./cache/company_data.cache
CACHE_LIFETIME=3600
</code>
</pre>

<br>
<h4>Variables explicadas</h4>

<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%;">
  <thead style="background-color: #f2f2f2;">
    <tr>
      <th>Variable</th>
      <th>Descripci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>API_URL</td>
      <td>URL del endpoint de la API utilizada para enviar las solicitudes de conversaci√≥n al modelo de IA.</td>
    </tr>
    <tr>
      <td>API_KEY</td>
      <td>Clave de autenticaci√≥n necesaria para acceder a la API. Debe mantenerse privada y segura.</td>
    </tr>
    <tr>
      <td>MODEL</td>
      <td>Identificador del modelo de lenguaje a utilizar. En este caso: <code>gpt-3.5-turbo</code>, uno de los modelos de OpenAI optimizado para velocidad y eficiencia en tareas conversacionales.</td>
    </tr>
    <tr>
      <td>COMPANY_DATA_PATH</td>
      <td>Ruta local al archivo JSON que contiene los datos de la empresa (por ejemplo, nombre, informaci√≥n de contacto o respuestas personalizadas).</td>
    </tr>
    <tr>
      <td>MAX_TOKENS</td>
      <td>N√∫mero m√°ximo de tokens (fragmentos de texto) que puede generar el modelo en cada respuesta. Limita la longitud de las respuestas.</td>
    </tr>
    <tr>
      <td>TEMPERATURE</td>
      <td>Valor de temperatura que controla la aleatoriedad de las respuestas. Valores bajos (ej. 0.2) producen respuestas m√°s deterministas; valores m√°s altos (0.7 o m√°s) generan respuestas m√°s creativas.</td>
    </tr>
    <tr>
      <td>CACHE_PATH</td>
      <td>Ruta local donde se almacenan los archivos de cach√© generados por el sistema para mejorar el rendimiento.</td>
    </tr>
    <tr>
      <td>COMPANY_CACHE_FILE</td>
      <td>Archivo espec√≠fico de cach√© que guarda temporalmente los datos procesados de la empresa. Reduce lecturas repetitivas del archivo original.</td>
    </tr>
    <tr>
      <td>CACHE_LIFETIME</td>
      <td>Tiempo de vida √∫til de la cach√© en segundos (ej. 3600 = 1 hora). Despu√©s de este per√≠odo, los datos se refrescan autom√°ticamente.</td>
    </tr>
  </tbody>
</table>

<div class="nota-importante">
  <div style="margin:1rem">
    <ul>
      <li>No compartas p√∫blicamente el archivo <code>.env</code>, especialmente si contiene claves API privadas.</li>
      <li>Este archivo debe estar ubicado en la ra√≠z del proyecto para ser correctamente interpretado por el entorno de ejecuci√≥n.</li>
      <li>Si modificas los valores del modelo o par√°metros de generaci√≥n, es recomendable reiniciar la aplicaci√≥n o limpiar la cach√©.</li>
    </ul>
  </div>

</div>
        </section>


        <!-- Guia PHP -->
        <section id="php-guia" class="doc-section">

          <h2><i class="fa-brands fa-php"></i> Gu√≠a PHP</h2>   
          <p style="color: #4361ee">/chatbot/chatbot.php</p>
          <p>El archivo <code>chatbot.php</code> implementa el backend funcional de un chatbot interactivo que se comunica con una API de inteligencia artificial compatible con est√°ndares como OpenAI, incluyendo Deepseek y OpenRouter (o compatible). Este script proporciona una soluci√≥n completa para integrar un asistente virtual en una aplicaci√≥n web o sitio, gestionando desde la comunicaci√≥n con la API hasta el manejo de sesiones, cach√© y respuestas estructuradas en formato JSON.</p>

          <h3>Configuraci√≥n del <code>chatbot.php</code></h3>
          <h4>Funci√≥n: <code>loadEnv()</code></h4>
          <p>La funci√≥n loadEnv se encarga de cargar las variables de entorno definidas en un archivo .env ubicado en la ruta especificada por el par√°metro $path. Estas variables son le√≠das l√≠nea por l√≠nea, procesadas para extraer su nombre y valor, y luego establecidas como variables de entorno del sistema utilizando la funci√≥n putenv(), lo que permite acceder a ellas posteriormente mediante getenv() o $_ENV.</p>

<pre>
<code class="language-php">
function loadEnv($path) {
    // Verifica si el archivo .env existe. Si no existe, se detiene la ejecuci√≥n de la funci√≥n.
    if (!file_exists($path)) return;

    // Lee el archivo l√≠nea por l√≠nea, ignorando l√≠neas vac√≠as y saltos de l√≠nea.
    $lines = file($path, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

    foreach ($lines as $line) {
        // Omite las l√≠neas que comienzan con '#' ya que se consideran comentarios en el archivo .env.
        // Versi√≥n compatible con PHP 7.4: if (strpos(trim($line), '#') === 0) continue;
        if (str_starts_with(trim($line), '#')) continue;

        // Divide cada l√≠nea en una clave y un valor utilizando el signo '=' como separador.
        list($name, $value) = explode('=', $line, 2);

        // Elimina espacios en blanco y comillas innecesarias de ambos lados.
        $name = trim($name);
        $value = trim($value, '"\'');

        // Establece la variable de entorno usando putenv(), que la hace accesible mediante getenv().
        putenv("$name=$value");
    }
}         
</code>
</pre>

<h4>Par√°metros:</h4>
<div style="margin: 1rem">
  <ol>
    <li>
      Verificaci√≥n del archivo.
      <ul style="padding-left: 1.5rem; list-style-type: disc;">
        <li>Si el archivo especificado no existe, la funci√≥n termina inmediatamente sin realizar ninguna acci√≥n.</li>
      </ul>
    </li>
    <li>
      Lectura del archivo.
      <ul style="padding-left: 1.5rem; list-style-type: disc;">
        <li>El archivo es le√≠do l√≠nea por l√≠nea.</li>
        <li>Se ignoran l√≠neas vac√≠as y saltos de l√≠nea gracias a las banderas <code>FILE_IGNORE_NEW_LINES</code> y <code>FILE_SKIP_EMPTY_LINES</code>.</li>
      </ul>
    </li>
    <li>
      Procesamiento de cada l√≠nea.
      <ul style="padding-left: 1.5rem; list-style-type: disc;">
        <li>Las l√≠neas que comienzan con el car√°cter <code>#</code> son tratadas como comentarios y omitidas.</li>
        <li>Cada l√≠nea v√°lida es dividida en dos partes: nombre  y valor , usando el primer signo igual (<code>=</code>) como separador.</li>
        <li>Se eliminan espacios en blanco y posibles comillas (simples o dobles) alrededor del valor.</li>
      </ul>
    </li>
    <li>
      Establecimiento de la variable de entorno.
      <ul style="padding-left: 1.5rem; list-style-type: disc;">
        <li>La variable es registrada como una variable de entorno del sistema mediante <code>putenv("$name=$value")</code>.</li>
      </ul>
    </li>
  </ol>
</div>


  <h4>Llama a la funci√≥n para cargar las variables desde el archivo .env ubicado en el mismo directorio que este archivo.</h4>
<pre><code class="language-php">
  loadEnv(__DIR__ . '/.env');
</code></pre>

<br>
<h3>Configuraci√≥n de Variables de Entorno</h3>
<pre><code class="language-php">
define('API_URL', getenv('API_URL'));                     
define('API_KEY', getenv('API_KEY'));                     
define('MODEL', getenv('MODEL'));                         
define('COMPANY_DATA_PATH', getenv('COMPANY_DATA_PATH')); 
define('MAX_TOKENS', getenv('MAX_TOKENS'));               
define('TEMPERATURE', (float) getenv('TEMPERATURE'));     
define('CACHE_PATH', getenv('CACHE_PATH'));               
define('COMPANY_CACHE_FILE', getenv('COMPANY_CACHE_FILE'));
define('CACHE_LIFETIME', getenv('CACHE_LIFETIME'));       
</code></pre>
<p>
Define constantes globales usando las variables cargadas desde el archivo .env.
Estas constantes son utilizadas en el resto de la aplicaci√≥n para configurar par√°metros clave como la API, modelo, etc.
</p>


<div style="margin:1rem">
  <ul>
    <li><b>API_URL:</b> Define la URL base para realizar las peticiones a la API de chat.</li>
    <li><b>API_KEY:</b> Establece la clave de autenticaci√≥n necesaria para acceder a la API.</li>
    <li><b>MODEL:</b> Indica qu√© modelo de lenguaje ser√° utilizado (por ejemplo: gpt-4, gpt-3.5, etc.).</li>
    <li><b>COMPANY_DATA_PATH:</b> Define la ruta hacia el archivo que contiene los datos relevantes de la empresa.</li>
    <li><b>MAX_TOKENS:</b> Limita la cantidad de tokens que puede generar el modelo en una respuesta.</li>
    <li><b>TEMPERATURE:</b> Controla la aleatoriedad de las respuestas del modelo; valores m√°s altos generan respuestas m√°s creativas.</li>
    <li><b>CACHE_PATH:</b> Ruta general donde se guardan archivos de cach√© para mejorar el rendimiento.</li>
    <li><b>COMPANY_CACHE_FILE:</b> Especifica el archivo de cach√© destinado a los datos de la empresa.</li>
    <li><b>CACHE_LIFETIME:</b> Determina el tiempo (en segundos) que un archivo de cach√© es considerado v√°lido antes de necesitar actualizaci√≥n.</li>
  </ul>
</div>

<br>
<h3>Configuraci√≥n de Visualizaci√≥n de Errores</h3>
<p>Este bloque de c√≥digo activa la visualizaci√≥n de todos los errores de PHP, lo cual es fundamental durante la etapa de desarrollo o pruebas para identificar y corregir problemas r√°pidamente.</p>

<pre><code class="language-php">
error_reporting(E_ALL);
ini_set('display_errors', 1);  
</code></pre>
<div style="margin:1rem">
  <ul>
    <li><b>error_reporting(E_ALL): </b>Configura PHP para que informe sobre todos los tipos de errores posibles, incluyendo notices, warnings y fatal errors. Esto es √∫til para asegurar que incluso los problemas menores se detecten a tiempo.</li>
    <li><b>ini_set('display_errors', 1): </b>Indica a PHP que muestre los errores directamente en el navegador o consola. Esto facilita el proceso de depuraci√≥n durante el desarrollo.</li>
  </ul>
</div>
<div class="nota-importante">
  <p>Estas configuraciones deben desactivarse o ajustarse en entornos de producci√≥n para evitar exponer informaci√≥n sensible a los usuarios finales. Para producci√≥n, se recomienda:</p>
</div>
<pre><code class="language-php">
ini_set('display_errors', 0);
</code></pre>

<br>
<h4>Funci√≥n: <code>load_company_data()</code></h4>
<p>Esta funci√≥n se encarga de cargar los datos de una empresa desde un archivo JSON, implementando un sistema de cach√© eficiente tanto en memoria (APCu) como en archivo local para mejorar el rendimiento en futuras solicitudes.</p>

<pre><code class="language-php">
function load_company_data() {
    // Verifica si el archivo de datos existe. Si no, lanza una excepci√≥n con un mensaje claro.
    if (!file_exists(COMPANY_DATA_PATH)) {
        throw new Exception("Archivo de datos de empresa no encontrado");
    }

    // Obtiene la √∫ltima fecha de modificaci√≥n del archivo y genera una clave √∫nica de cach√©.
    $lastModified = filemtime(COMPANY_DATA_PATH);
    $cacheKey = 'company_data_' . md5(COMPANY_DATA_PATH) . '_' . $lastModified;

    // Si la extensi√≥n APCu est√° habilitada y la cach√© est√° disponible, devuelve los datos 
    // directamente desde la cach√©.
    if (extension_loaded('apcu') && apcu_exists($cacheKey)) {
        return apcu_fetch($cacheKey);
    }

    // Verifica si hay un archivo de cach√© local disponible y coincide con la clave generada.
    if (file_exists(COMPANY_CACHE_FILE)) {
        $cacheData = json_decode(file_get_contents(COMPANY_CACHE_FILE), true);

        // Si la cach√© es v√°lida y coincide con la clave, la devuelve (y la vuelve a almacenar en 
        // APCu si est√° habilitada).
        if ($cacheData && isset($cacheData['cache_key']) && $cacheData['cache_key'] === $cacheKey) {
            if (extension_loaded('apcu')) {
                apcu_store($cacheKey, $cacheData['content'], CACHE_LIFETIME);
            }
            return $cacheData['content'];
        }
    }

    // Si no se encuentra la cach√©, carga los datos desde el archivo JSON directamente.
    $jsonData = file_get_contents(COMPANY_DATA_PATH);
    $data = json_decode($jsonData, true);

    // Verifica si hubo un error al decodificar el JSON.
    if (json_last_error() !== JSON_ERROR_NONE) {
        throw new Exception("Error decodificando JSON: " . json_last_error_msg());
    }

    // Prepara la estructura de cach√© con los datos cargados.
    $cacheData = [
        'cache_key' => $cacheKey,
        'content' => $data,
        'timestamp' => time(),
        'source' => COMPANY_DATA_PATH
    ];

    // Almacena los datos en APCu si est√° disponible.
    if (extension_loaded('apcu')) {
        apcu_store($cacheKey, $data, CACHE_LIFETIME);
    }

    // Asegura que la carpeta de cach√© exista antes de guardar el archivo.
    if (!file_exists(CACHE_PATH)) {
        mkdir(CACHE_PATH, 0755, true);
    }

    // Guarda los datos de cach√© en un archivo local para accesos futuros.
    file_put_contents(COMPANY_CACHE_FILE, json_encode($cacheData));

    // Devuelve los datos cargados.
    return $data;
}
</code></pre>
<h4>Caracter√≠sticas principales:</h4>
<div style="margin:1rem">
  <ul>
  <li><strong>Validaci√≥n de archivo fuente</strong>: Verifica que el archivo de datos (<code>COMPANY_DATA_PATH</code>) exista. Si no, lanza una excepci√≥n clara para facilitar la depuraci√≥n.</li>
  <li><strong>Gesti√≥n de cach√© inteligente</strong>:
    <ul style="margin-left: 20px;">
      <li>Utiliza una clave de cach√© √∫nica generada a partir del hash del nombre del archivo y su √∫ltima fecha de modificaci√≥n.</li>
      <li>Soporte para almacenamiento en cach√© con APCu (si est√° habilitado).</li>
      <li>Uso de un archivo de cach√© local (<code>COMPANY_CACHE_FILE</code>) como respaldo cuando APCu no est√° disponible o en caso de reinicio del servidor.</li>
    </ul>
  </li>
  <li><strong>Decodificaci√≥n segura de JSON</strong>: Verifica errores al decodificar el contenido del archivo JSON y lanza una excepci√≥n detallada si ocurre un error.</li>
  <li><strong>Persistencia de cach√©</strong>:
    <ul style="margin-left: 20px;">
      <li>Almacena los datos en la memoria (APCu) si est√° disponible.</li>
      <li>Guarda una copia persistente en disco para mejorar el tiempo de respuesta en futuras cargas.</li>
    </ul>
  </li>
  <li><strong>Creaci√≥n autom√°tica del directorio de cach√©</strong>: Si la carpeta definida en <code>CACHE_PATH</code> no existe, la crea autom√°ticamente con los permisos adecuados.</li>
</ul>
</div>

<h4>Flujo general:</h4>
<div style="margin:1rem">
  <ol>
    <li>Verifica la existencia del archivo original de datos.</li>
    <li>Genera una clave de cach√© basada en el archivo y su fecha de modificaci√≥n.</li>
    <li>Intenta obtener los datos desde APCu.</li>
    <li>Si no est√°n en APCu, busca en un archivo de cach√© local.</li>
    <li>Si no hay cach√© v√°lida, carga y valida el contenido JSON directamente del archivo.</li>
    <li>Almacena los datos en APCu y en un archivo local para futuras consultas.</li>
    <li>Devuelve los datos como un array asociativo.</li>
  </ol>
</div>


<br>
<h4>Funci√≥n: <code>clear_company_data_cache()</code></h4>
<p>Esta funci√≥n permite limpiar manualmente la cach√© asociada a los datos de empresa. Es √∫til cuando se requiere forzar la recarga de la informaci√≥n desde el archivo original, ya sea por cambios recientes en el contenido o durante tareas de mantenimiento.</p>
<pre><code class="language-php">
function clear_company_data_cache() {
    // Si la extensi√≥n APCu est√° disponible, borra toda la cach√© de usuario almacenada en memoria.
    if (extension_loaded('apcu')) {
        apcu_clear_cache();  // Limpia la cach√© APCu para garantizar que se vuelva a cargar desde el archivo fuente.
    }

    // Si existe un archivo de cach√© local, lo elimina del sistema de archivos.
    if (file_exists(COMPANY_CACHE_FILE)) {
        unlink(COMPANY_CACHE_FILE);  // Borra el archivo de cach√© para forzar su regeneraci√≥n.
    }

    // Devuelve true para indicar que la operaci√≥n se complet√≥ correctamente.
    return true;
}
</code></pre>

<h4>Prop√≥sito:</h4>
<p>Eliminar cualquier versi√≥n en cach√© de los datos de empresa, tanto en memoria (APCu) como en disco, asegurando que en la pr√≥xima carga se utilicen datos frescos desde la fuente.</p>

<h4>Detalles de funcionamiento:</h4>
<div style="margin:1rem">
<ul>
  <li><strong>Limpieza de memoria (APCu):</strong>  
    Si la extensi√≥n <code>apcu</code> est√° habilitada en el servidor, la funci√≥n llama a <code>apcu_clear_cache()</code> para eliminar toda la cach√© de usuario almacenada en memoria. Esto es especialmente √∫til para evitar el uso de datos obsoletos en entornos con m√∫ltiples usuarios o procesos concurrentes.
  </li>
  <li><strong>Eliminaci√≥n del archivo de cach√© local:</strong>  
    Si existe un archivo en disco definido por la constante <code>COMPANY_CACHE_FILE</code>, se elimina usando <code>unlink()</code>. Esto garantiza que el sistema de cach√© en archivo tambi√©n se regenere con la informaci√≥n actualizada.
  </li>
  <li><strong>Retorno:</strong>  
    La funci√≥n siempre devuelve <code>true</code>, indicando que el proceso de limpieza se ejecut√≥ correctamente, sin importar si hab√≠a o no datos previamente almacenados.
  </li>
</ul>
</div>


<br>
<h4>Funci√≥n: <code>testAPIConnection()</code></h4>
<p>Esta funci√≥n realiza una prueba de conectividad con la API configurada para verificar si est√° operativa y respondiendo correctamente.</p>
<pre><code class="language-php">
function testAPIConnection() {
    // Estructura del mensaje de prueba para el modelo especificado
    $testPayload = [
        'model' => MODEL, // Modelo definido en la configuraci√≥n
        'messages' => [
            ['role' => 'system', 'content' => 'Eres un asistente √∫til'],
            ['role' => 'user', 'content' => 'Responde con OK si est√°s funcionando']
        ],
        'temperature' => TEMPERATURE,  // Nivel de creatividad en la respuesta
        'max_tokens' => 50             // L√≠mite de tokens en la respuesta
    ];

    // Inicializa cURL para realizar la solicitud HTTP
    $ch = curl_init(API_URL);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,              // Retorna la respuesta como string
        CURLOPT_POST => true,                        // M√©todo POST
        CURLOPT_POSTFIELDS => json_encode($testPayload), // Convierte los datos a JSON
        CURLOPT_HTTPHEADER => [
            'Content-Type: application/json',
            'Authorization: Bearer ' . API_KEY        // Autenticaci√≥n con token
        ],
        CURLOPT_TIMEOUT => 15,                       // Tiempo m√°ximo de espera en segundos
        CURLOPT_SSL_VERIFYPEER => true               // Verifica el certificado SSL
    ]);

    // Ejecuta la solicitud y captura la respuesta
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    $error = curl_error($ch);
    curl_close($ch);

    // Devuelve un arreglo con informaci√≥n de estado y datos de respuesta
    return [
        'success' => $httpCode === 200, // √âxito si el c√≥digo HTTP es 200
        'http_code' => $httpCode,       // C√≥digo de respuesta HTTP
        'response' => $response,        // Cuerpo de la respuesta (JSON)
        'error' => $error               // Mensaje de error en caso de fallo
    ];
}
</code></pre>
<h4>Prop√≥sito:</h4>
<p>Enviar un mensaje de prueba al modelo definido y comprobar que la API responde correctamente, t√≠picamente con una respuesta simple como <code>"OK"</code>.</p>

<h4>Detalles de funcionamiento:</h4>
<div style="margin:1rem">
<ul>
  <li><strong>Mensaje de prueba:</strong>
    Se prepara un payload con un mensaje estructurado para el modelo definido en la constante <code>MODEL</code>. Incluye un mensaje de sistema y una solicitud del usuario que espera como respuesta la palabra <code>"OK"</code>.
  </li>
  <li><strong>Configuraci√≥n de la solicitud:</strong>
    Se utiliza <code>cURL</code> para enviar la solicitud HTTP POST a la URL definida por <code>API_URL</code>. La autenticaci√≥n se realiza mediante token usando la constante <code>API_KEY</code>.
  </li>
  <li><strong>Par√°metros de la solicitud:</strong>
    <ul style="margin-left: 20px;">
      <li><code>temperature</code>: nivel de creatividad en la respuesta, definido por <code>TEMPERATURE</code>.</li>
      <li><code>max_tokens</code>: l√≠mite de tokens de la respuesta, establecido en 50.</li>
      <li><code>CURLOPT_TIMEOUT</code>: 15 segundos de espera m√°xima.</li>
      <li><code>CURLOPT_SSL_VERIFYPEER</code>: habilitado para verificar la seguridad del certificado SSL.</li>
    </ul>
  </li>
  <li><strong>Respuesta:</strong>
    Una vez ejecutada la solicitud, se captura la respuesta, el c√≥digo HTTP y cualquier error producido por <code>cURL</code>. Esta informaci√≥n se devuelve en forma de array.
  </li>
</ul>
</div>

<h4>Retorno:</h4>
<p>Un array que contiene:</p>
<div style="margin:1rem">
<ul>
  <li><code>success</code>: <code>true</code> si la respuesta HTTP fue 200.</li>
  <li><code>http_code</code>: el c√≥digo HTTP recibido.</li>
  <li><code>response</code>: el contenido del cuerpo de la respuesta (en JSON).</li>
  <li><code>error</code>: mensaje de error si la conexi√≥n fall√≥.</li>
</ul>
</div>

<br>
<h4>Funci√≥n: <code>callAIModelAPI()</code></h4>
<p>Esta funci√≥n realiza una llamada a una API de modelo de lenguaje (como OpenAI) para generar una respuesta contextualizada basada en datos espec√≠ficos de una empresa. Utiliza cURL para enviar una solicitud JSON que incluye tanto el historial de conversaci√≥n como los datos de empresa.</p>
<pre><code class="language-php">
function callAIModelAPI($prompt) {
    try {
        // Cargar los datos de la empresa desde el archivo de datos.
        $companyData = load_company_data();

        // Construir los mensajes iniciales para la API, que incluyen el contexto sobre la empresa.
        $messages = [
            [
                'role' => 'system',
                'content' => sprintf(
                    'Eres un asistente virtual que responde preguntas sobre una empresa. '.
                    'Solo debes responder preguntas relacionadas con la empresa. '.
                    'Mant√©n tus respuestas claras y concisas. '.
                    'Si no sabes la respuesta, di que no tienes esa informaci√≥n. '.
                    'Datos de la empresa: %s',
                    json_encode($companyData, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES)
                )
            ]
        ];

        // Incluir el historial de mensajes de la sesi√≥n, si est√° disponible.
        if (!empty($_SESSION['chat_history'])) {
            foreach ($_SESSION['chat_history'] as $msg) {
                $messages[] = [
                    'role' => $msg['role'],
                    'content' => $msg['content']
                ];
            }
        }

        // A√±adir el mensaje del usuario al historial.
        $messages[] = ['role' => 'user', 'content' => $prompt];

        // Preparar los datos para la solicitud POST a la API.
        $postData = [
            'model' => MODEL,
            'messages' => $messages,
            'temperature' => TEMPERATURE,
            'max_tokens' => MAX_TOKENS
        ];

        // Inicializar cURL para enviar la solicitud a la API.
        $ch = curl_init(API_URL);
        curl_setopt_array($ch, [
            CURLOPT_RETURNTRANSFER => true,  // Devolver la respuesta como una cadena.
            CURLOPT_POST => true,            // Usar el m√©todo POST.
            CURLOPT_POSTFIELDS => json_encode($postData),  // Enviar los datos como JSON.
            CURLOPT_HTTPHEADER => [
                'Content-Type: application/json',  // Tipo de contenido JSON.
                'Authorization: Bearer ' . API_KEY  // Autorizaci√≥n con la clave API.
            ],
            CURLOPT_TIMEOUT => 30  // Tiempo m√°ximo de espera para la respuesta.
        ]);

        // Ejecutar la solicitud cURL.
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);  // Obtener el c√≥digo de estado HTTP.

        // Comprobar si ocurri√≥ alg√∫n error durante la solicitud cURL.
        if (curl_errno($ch)) {
            throw new Exception("Error CURL: " . curl_error($ch));
        }
        curl_close($ch);  // Cerrar la sesi√≥n cURL.

        // Verificar si la API respondi√≥ correctamente.
        if ($httpCode !== 200) {
            throw new Exception("API respondi√≥ con c√≥digo HTTP $httpCode");
        }

        // Decodificar la respuesta JSON de la API.
        $responseData = json_decode($response, true);

        // Verificar que la respuesta contiene el contenido esperado.
        if (!isset($responseData['choices'][0]['message']['content'])) {
            throw new Exception("Respuesta inesperada de la API");
        }

        // Devolver el contenido generado por el modelo.
        return $responseData['choices'][0]['message']['content'];

    } catch (Exception $e) {
        // Registrar el error en el log de errores para su depuraci√≥n.
        error_log("Error en callAIModelAPI: " . $e->getMessage());
        return false;  // Devolver false en caso de error.
    }
}
</code></pre>

<h4>Prop√≥sito:</h4>
<p>Enviar una solicitud a la API del modelo con un contexto empresarial y un historial de conversaci√≥n, obteniendo como resultado una respuesta generada en lenguaje natural.</p>

<h4>Flujo de funcionamiento:</h4>
<div style="margin:1rem">
<ul>
  <li><strong>Carga de datos:</strong>
    <ul style="margin-left: 20px;">
      <li>Se cargan los datos de la empresa mediante la funci√≥n <code>load_company_data()</code>.</li>
      <li>Estos datos se codifican en formato JSON y se incluyen en el mensaje de sistema como contexto.</li>
    </ul>
  </li>
  <li><strong>Mensajes:</strong>
    <ul style="margin-left: 20px;">
      <li>El mensaje de sistema establece las reglas del asistente (solo responder sobre la empresa, respuestas claras, etc.).</li>
      <li>Se incluyen mensajes previos desde <code>$_SESSION['chat_history']</code> si est√°n disponibles.</li>
      <li>Se agrega el mensaje actual del usuario recibido como par√°metro <code>$prompt</code>.</li>
    </ul>
  </li>
  <li><strong>Configuraci√≥n y env√≠o de la solicitud:</strong>
    <ul style="margin-left: 20px;">
      <li>Se prepara el array <code>$postData</code> con el modelo, mensajes, temperatura y l√≠mite de tokens.</li>
      <li>Se inicializa y configura <code>cURL</code> para enviar la solicitud POST con autenticaci√≥n v√≠a <code>API_KEY</code>.</li>
    </ul>
  </li>
  <li><strong>Manejo de errores:</strong>
    <ul style="margin-left: 20px;">
      <li>Se verifica si <code>cURL</code> devuelve errores o si el c√≥digo HTTP es distinto de 200.</li>
      <li>En caso de error, se lanza una excepci√≥n que es registrada con <code>error_log()</code>.</li>
    </ul>
  </li>
  <li><strong>Respuesta:</strong>
    <ul style="margin-left: 20px;">
      <li>Se decodifica la respuesta JSON.</li>
      <li>Si el contenido esperado existe, se retorna como string.</li>
      <li>En caso contrario, se retorna <code>false</code>.</li>
    </ul>
  </li>
</ul>
</div>

<h4>Par√°metros:</h4>
<div style="margin:1rem">
<ul>
  <li><code>$prompt</code>: Cadena de texto con la pregunta o instrucci√≥n del usuario.</li>
</ul>
</div>

<h4>Retorno:</h4>
<div style="margin:1rem">
<ul>
  <li><code>string</code>: La respuesta generada por el modelo de lenguaje.</li>
  <li><code>false</code>: Si ocurre alg√∫n error durante la ejecuci√≥n.</li>
</ul>
</div>


<br>
<h3>Controlador principal del backend</h3>
<p>Este bloque de c√≥digo es el controlador principal del backend para manejar peticiones a un chatbot que responde preguntas sobre una empresa. Aqu√≠ est√° el resumen de c√≥mo funciona, con explicaciones claras por secci√≥n:</p>
<h4>Encabezado de respuesta JSON</h4>
<pre><code class="language-php">
header('Content-Type: application/json');
</code></pre>
<p>Asegura que todas las respuestas que devuelve este script sean en formato JSON.</p>

<h4>Acciones GET: Test y limpiar cach√©</h4>

<div style="margin:1rem">
  <ul>
    <li><code>?test_connection</code>: Llama a una funci√≥n que prueba si la API de IA responde correctamente.</li>
    <li><code>?clear_cache=true</code>: Limpia el cach√© de los datos de la empresa (√∫til si los datos se actualizan).</li>
  </ul>
</div>
<h4>Valida que solo se acepten solicitudes POST</h4>
<pre><code class="language-php">
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    throw new Exception("M√©todo no permitido", 405);
}
</code></pre>
<p>Evita que otros m√©todos (GET, PUT, DELETE) intenten ejecutar acciones que requieren seguridad y estructura POST.</p>

<h4>Validaci√≥n de acci√≥n POST</h4>
<pre><code class="language-php">
if (empty($_POST['action'])) {
    throw new Exception("Acci√≥n no especificada", 400);
}
</code></pre>
<p>Se asegura de que cada petici√≥n POST indique qu√© acci√≥n se desea realizar (send_message, load_history, etc.).</p>

<h4>L√≥gica para cada acci√≥n:</h4>
<pre><code class="language-php">
switch ($action)
</code></pre>
<div style="margin:1rem">
<ul>
  <li><strong>send_message</strong>
    <ul style="margin-left: 20px;">
      <li>Env√≠a un mensaje del usuario.</li>
      <li>Llama a <code>callAIModelAPI($userMessage)</code> para obtener respuesta del modelo.</li>
      <li>Guarda tanto el mensaje del usuario como la respuesta del modelo en <code>$_SESSION['chat_history']</code>.</li>
    </ul>
  </li>
  <li><strong>load_history</strong>
    <ul style="margin-left: 20px;">
      <li>Devuelve todo el historial de conversaci√≥n almacenado en la sesi√≥n actual.</li>
    </ul>
  </li>
  <li><strong>clear_history</strong>
    <ul style="margin-left: 20px;">
      <li>Limpia todo el historial de la sesi√≥n.</li>
    </ul>
  </li>
  <li><strong>Acci√≥n no v√°lida</strong>
    <ul style="margin-left: 20px;">
      <li>Si se pasa un action desconocido, lanza un error 400.</li>
    </ul>
  </li>
</ul>
</div>

<h4>Manejo de errores</h4>
<pre><code class="language-php">
http_response_code($e->getCode() ?: 500);
</code></pre>
<p>Captura cualquier excepci√≥n, devuelve un error en formato JSON y establece el c√≥digo HTTP adecuado (400, 405, 500, etc.).</p>

</section>









        <!-- Guia HTML -->
        <section id="html-guia" class="doc-section">
          <h2><i class="fas fa-code"></i> Gu√≠a HTML</h2>
          <p>
            El chatbot est√° compuesto por tres componentes principales: un
            mensaje de invitaci√≥n, un bot√≥n de toggle y el contenedor principal
            del chat.
          </p>
          <ul class="feature-list">
            <li>
              <strong>Mensaje de invitaci√≥n (chatbot-invite):</strong> Un
              elemento simple que muestra el texto "¬°Chatea con nosotros!"
            </li>
            <li>
              <strong>Bot√≥n de Toggle (chatbot-toggle):</strong> Contiene una
              imagen del icono del chatbot (50x50px) con efecto de zoom
            </li>
            <li>
              <strong>Contenedor Principal (chatbot-container):</strong>
              Inicialmente oculto, dividido en tres secciones (encabezado, √°rea
              de mensajes y pie de chat)
            </li>
          </ul>
          <h3>Estructura b√°sica</h3>
          <div class="code-example">
            <div id="html-example" class="tab-content" style="display: block">
              <pre><code class="language-html">
  &lt;!-- Mensaje de invitaci√≥n para iniciar el chat --&gt;
  &lt;div id="chatbot-invite" class="chatbot-invite"&gt;
    &lt;span&gt;¬°Chatea con nosotros!&lt;/span&gt;
  &lt;/div&gt;
  
  &lt;!-- Bot√≥n para abrir/cerrar el chatbot --&gt;
  &lt;div id="chatbot-toggle" class="chatbot-toggle"&gt;
    &lt;img
      src="./chatbot/img/chatbot.png"
      width="50"
      height="50"
      alt="chatbot"
      class="img-zoom"
    /&gt;
  &lt;/div&gt;
  
  &lt;!-- Contenedor principal del chatbot --&gt;
  &lt;div id="chatbot-container" class="chatbot-container hidden"&gt;
    &lt;!-- Encabezado del chatbot --&gt;
    &lt;div class="chatbot-header"&gt;
      &lt;span style="display: inline-flex; align-items: center; gap: 8px"&gt;
        &lt;img
          src="./chatbot/img/chatbot.png"
          width="50"
          height="50"
          alt="chatbot"
          class="img-zoom"
        /&gt;
        &lt;span&gt;Tu Asistente Virtual&lt;/span&gt;
      &lt;/span&gt;
      &lt;button id="chatbot-close" class="chatbot-close"&gt;
        &lt;i class="fa-solid fa-circle-xmark"&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  
    &lt;!-- √Årea de mensajes --&gt;
    &lt;div id="chatbot-messages" class="chatbot-messages"&gt;
      &lt;!-- Aqu√≠ se renderizan los mensajes --&gt;
    &lt;/div&gt;
  
    &lt;!-- Pie del chatbot con campo de entrada y bot√≥n de enviar --&gt;
    &lt;div class="chatbot-footer"&gt;
      &lt;button class="clear-history-btn"&gt;
        &lt;i class="fa-regular fa-trash-can" title="Limpiar Chat"&gt;&lt;/i&gt;
      &lt;/button&gt;
      &lt;input
        type="text"
        id="chatbot-input-field"
        class="chatbot-input-field"
        placeholder="Escribe tu mensaje..."
        autofocus
      /&gt;
      &lt;button id="chatbot-send" class="chatbot-send"&gt;
        &lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  </code></pre>

  <p>
                A continuaci√≥n, se presenta una explicaci√≥n detallada tanto del
                HTML como del CSS proporcionados, con el objetivo de facilitar
                la documentaci√≥n y comprensi√≥n de su funcionalidad y dise√±o.
              </p>
              <h3>1. Estructura HTML</h3>
              <p>
                El c√≥digo HTML representa un chatbot interactivo que incluye
                elementos para la invitaci√≥n, el contenedor principal del chat,
                el √°rea de mensajes y el pie con funcionalidades adicionales.
              </p>
              <p><b>Elementos principales:</b></p>
              <p>
                1.1 Mensaje de invitaci√≥n (<span style="color: red"
                  >#chatbot-invite</span
                >)
              </p>
              <pre><code class="language-html">
  &lt;div id="chatbot-invite" class="chatbot-invite"&gt;
    &lt;span&gt;¬°Chatea con nosotros!&lt;/span&gt;
  &lt;/div&gt;
  </code></pre>
              <div style="margin:1rem">
                <ul>
                <li>
                  Este elemento es un mensaje flotante que anima a los usuarios
                  a iniciar una conversaci√≥n.
                </li>
                <li>
                  Contiene un texto simple ("¬°Chatea con nosotros!") que se
                  muestra de manera condicional (visible u oculta) seg√∫n la
                  interacci√≥n del usuario.
                </li>
              </ul>
              </div>
              <br />
              <p>
                1.2 Bot√≥n para abrir/cerrar el chatbot (<span style="color: red"
                  >#chatbot-toggle</span
                >)
              </p>
              <pre><code class="language-html">
  &lt;div id="chatbot-toggle" class="chatbot-toggle"&gt;
    &lt;img src="./chatbot/img/chatbot.png" width="50" height="50" alt="chatbot" class="img-zoom" /&gt;
  &lt;/div&gt;
  </code></pre>
  <div style="margin:1rem">
              <ul>
                <li>
                  Este bot√≥n permite abrir o cerrar el contenedor principal del
                  chatbot.
                </li>
                <li>
                  Utiliza una imagen representativa del chatbot con efecto de
                  zoom al pasar el cursor sobre ella (class="img-zoom").
                </li>
              </ul>
            </div>
              <br />
              <p>
                1.3 Contenedor principal del chatbot (<span style="color: red"
                  >#chatbot-container</span
                >)
              </p>
              <pre><code class="language-html">
  &lt;div id="chatbot-container" class="chatbot-container hidden"&gt;
    &lt;!-- Encabezado --&gt;
    &lt;div class="chatbot-header"&gt;
      &lt;span&gt;
        &lt;img src="./chatbot/img/chatbot.png" width="50" height="50" alt="chatbot" class="img-zoom" /&gt;
        &lt;span&gt;Tu Asistente Virtual&lt;/span&gt;
      &lt;/span&gt;
      &lt;button id="chatbot-close" class="chatbot-close"&gt;
        &lt;i class="fa-solid fa-circle-xmark"&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  
    &lt;!-- √Årea de mensajes --&gt;
    &lt;div id="chatbot-messages" class="chatbot-messages"&gt;
      &lt;!-- Aqu√≠ se renderizan los mensajes --&gt;
    &lt;/div&gt;
  
    &lt;!-- Pie del chatbot --&gt;
    &lt;div class="chatbot-footer"&gt;
      &lt;button class="clear-history-btn"&gt;
        &lt;i class="fa-regular fa-trash-can" title="Limpiar Chat"&gt;&lt;/i&gt;
      &lt;/button&gt;
      &lt;input type="text" id="chatbot-input-field" class="chatbot-input-field" 
      placeholder="Escribe tu mensaje..." autofocus /&gt;
      &lt;button id="chatbot-send" class="chatbot-send"&gt;
        &lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  </code></pre>
              <p>
                <b>Encabezado (<code>chatbot-header</code>):</b>
                <div style="margin:1rem">
                <ul>
                  <li>
                    Contiene una imagen del chatbot y un t√≠tulo ("Tu Asistente Virtual").
                  </li>
                  <li>
                    Incluye un bot√≥n de cierre (<code>chatbot-close</code>) con un √≠cono de "X".
                  </li>
                </ul>
                </div>
              </p>
              <p>
                <b> √Årea de mensajes (<code>chatbot-messages</code>):</b>
                <div style="margin:1rem">
                <ul>
                  <li>Es un contenedor din√°mico donde se renderizan los mensajes enviados por el usuario y las respuestas del bot.</li>
                  <li>Los mensajes se organizan en una estructura flexible (<code>flex-direction: column)</code> con espacio entre ellos.</li>
                </ul>
                </div>
              </p>
              <p>
                <b>Pie del chatbot (<code>chatbot-footer</code>):</b>
                <div style="margin:1rem">
                <ul>
                  <li>Incluye un bot√≥n para limpiar el historial de chat (<code>clear-history-btn</code>).</li>
                  <li>Un campo de entrada (<code>chatbot-input-field</code>) para escribir mensajes.</li>
                  <li>Un bot√≥n de env√≠o (<code>chatbot-send</code>) con un √≠cono de avi√≥n de papel.</li>
                </ul>
                </div>
              </p>
            </div>

              

          </div>
        </section>

        <section id="css-guia" class="doc-section">
          <h2><i class="fab fa-css3-alt"></i> Gu√≠a CSS</h2>
          <p>
            El CSS define la apariencia visual y las animaciones del chatbot, asegurando una experiencia de usuario fluida y atractiva.
          </p>

          <h3>Mensaje de invitaci√≥n inicial</h3>
          <p>Este fragmento de c√≥digo CSS define los estilos visuales para el mensaje de invitaci√≥n inicial del chatbot, que aparece de forma discreta pero llamativa en la esquina inferior derecha del sitio web.</p>

<pre><code class="language-css">
.chatbot-invite {
  position: fixed;
  bottom: 60px;
  right: 80px;
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  padding: 8px 15px;
  border-radius: 20px;
  border-bottom-right-radius: 5px;
  font-size: 14px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  z-index: 998;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  transform: translateY(10px);
}

/* Clase activa para mostrar el mensaje de invitaci√≥n */
.chatbot-invite.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

/* Ajuste para dispositivos m√≥viles */
@media (max-width: 768px) {
  .chatbot-invite {
    bottom: 70px;
    right: 20px;
    font-size: 13px;
  }
}
  </code></pre>
  <h4>Clase auxiliar: <code>.chatbot-invite</code></h4>
  <p>Este elemento tiene como objetivo invitar al usuario a iniciar una conversaci√≥n con el chatbot. Sus principales caracter√≠sticas son:</p>
  

  <div style="margin:1rem">
    <ul>
      <li><b>Posici√≥n fija:</b> ubicado en la parte inferior derecha (bottom: 60px; right: 80px), siempre visible incluso al hacer scroll.</li>
      <li><b>Dise√±o atractivo:</b> utiliza un degradado de color azul para captar la atenci√≥n del usuario.</li>
      <li><b>Estilo moderno:</b> con bordes redondeados, sombra y tipograf√≠a clara y peque√±a.</li>
      <li><b>Aparici√≥n con animaci√≥n:</b> inicialmente oculto con opacity: 0 y visibility: hidden, pero al a√±adirse la clase .visible, se anima suavemente hacia su posici√≥n final mediante transform y transition.</li>
    </ul>
  </div>
  <h4>Clase auxiliar: <code>.chatbot-invite.visible</code></h4>

<p>Esta clase activa la visibilidad del mensaje, permitiendo que aparezca con una animaci√≥n de entrada (<code>opacity: 1, transform: translateY(0)</code>), haciendo que la invitaci√≥n sea m√°s din√°mica e intuitiva para el usuario.</p>

<h4>Responsividad</h4>
<p>Incluye una media query para pantallas peque√±as (‚â§768px), ajustando la posici√≥n y el tama√±o del texto para garantizar una buena experiencia en dispositivos m√≥viles:
</p>
<div style="margin:1rem">
    <ul>
      <li>Posici√≥n m√°s accesible (bottom: 70px; right: 20px).</li>
      <li>Texto ligeramente m√°s peque√±o (font-size: 13px).</li>
    </ul>
  </div>

<br>
<h3>Estilos de mensajes (error, typing, etc.)</h3>
<p>Esta secci√≥n del archivo CSS define los estilos visuales para diferentes tipos de mensajes del chatbot, como errores, estados de escritura y sugerencias de reintento. Los estilos est√°n dise√±ados para mejorar la experiencia del usuario y proporcionar una comunicaci√≥n clara sobre el estado del sistema.</p>
<pre><code class="language-css">
.error-message {
  background-color: #ffebee;
  border-left: 4px solid #f44336;
}

.retry-text {
  font-size: 0.8rem;
  color: #666;
  margin-top: 5px !important;
  font-style: italic;
}

.typing-message {
  background-color: #f5f5f5;
  color: #333;
}
</code></pre>

<h4>Error</h4>
<p>Estilo utilizado para mostrar mensajes de error (por ejemplo, fallos en la conexi√≥n o respuestas inv√°lidas)
</p>
<h4>Reintentar texto</h4>
<p>Texto complementario que sugiere al usuario intentar de nuevo despu√©s de un error
</p>
<h4>Typing</h4>
<p>Indica visualmente que el chatbot est√° escribiendo una respuesta
</p>



<br>
<h3>Contenedor principal del chatbot</h3>
<p>Esta secci√≥n define el estilo base y comportamiento visual del contenedor principal del chatbot, encargado de alojar toda la interfaz de conversaci√≥n con el usuario.</p>
<pre><code class="language-css">
#chatbot-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 400px;
  height: 600px;
  max-height: 80vh;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 1000;
  border: 1px solid #e1e1e1;
  transition: all 0.3s ease;
}

/* Estado oculto del chatbot */
#chatbot-container.hidden {
  transform: translateY(20px);
  opacity: 0;
  visibility: hidden;
}
</code></pre>

<p>Contenedor fijo y flotante que aparece en la esquina inferior derecha de la pantalla:</p>
<div style="margin:1rem">
    <ul>
      <li>Posici√≥n fija (<code>fixed</code>) en la parte inferior-derecha (<code>bottom: 20px; right: 20px</code>) para mantenerlo visible mientras el usuario navega.</li>
      <li>Dimensiones predeterminadas de 400x600px y un <code>max-height</code> de <code>80vh</code> para asegurar buena visualizaci√≥n en diferentes pantallas.</li>
    </ul>
  </div>

<br>
<h3>Encabezado del chatbot</h3>
<p>Esta secci√≥n define los estilos visuales del encabezado superior del chatbot, donde se presenta el t√≠tulo o mensaje de bienvenida y el bot√≥n para cerrarlo.</p>
<pre><code class="language-css">
.chatbot-header {
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  padding: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.wellcome {
  margin-top: 20px;
}

.chatbot-close {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
}
</code></pre>
<p>Contenedor principal del encabezado del chatbot, dise√±ado para destacar y facilitar la interacci√≥n del usuario</p>


<br>
<h3>√Årea de mensajes</h3>
<p>Esta secci√≥n define los estilos del √°rea donde se visualizan las conversaciones entre el usuario y el chatbot, incluyendo mensajes, burbujas, y estados como ‚Äúescribiendo...‚Äù.</p>
<pre><code class="language-css">
.chatbot-header {
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  padding: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.wellcome {
  margin-top: 20px;
}

.chatbot-close {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
}
</code></pre>
<p>Cada burbuja est√° dise√±ada para mantener una conversaci√≥n clara y visualmente coherente, con una interfaz limpia que simula una experiencia de chat moderna y accesible tanto en escritorio como en m√≥viles.</p>


<br>
<h3>Indicador de "escribiendo..."", destacando que visualmente son 3 puntos animados</h3>
<p>Esta secci√≥n define la animaci√≥n visual que indica cuando el chatbot est√° escribiendo una respuesta. Se compone de tres puntos animados que simulan el cl√°sico efecto de "escribiendo..." en interfaces de mensajer√≠a.</p>
<pre><code class="language-css">
.typing-indicator {
  display: flex;
  gap: 5px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: #666;
  border-radius: 50%;
  animation: typingAnimation 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) {
  animation-delay: 0s;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typingAnimation {
  0%,
  60%,
  100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-5px);
  }
}
</code></pre>
<p>Este componente mejora la experiencia del usuario, transmitiendo que el sistema est√° procesando la informaci√≥n antes de responder. El dise√±o es simple, ligero y perfectamente adaptable a cualquier estilo de chatbot.</p>


<br>
<h3>Pie del Chatbot (Input y Botones)</h3>
<p>Esta secci√≥n define el √°rea inferior del chatbot, que permite al usuario escribir y enviar mensajes. Incluye un campo de entrada de texto y un bot√≥n de env√≠o estilizado.</p>
<pre><code class="language-css">
.chatbot-footer {
  padding: 10px;
  border-top: 1px solid #eee;
  display: flex;
  gap: 5px;
}

.chatbot-input-field {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 20px;
  outline: none;
  transition: none !important;
}

.chatbot-send {
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
}
</code></pre>
<p>Este pie de conversaci√≥n proporciona una experiencia de usuario clara y accesible, combinando dise√±o limpio y funcionalidad esencial para facilitar el env√≠o de mensajes en el chatbot.</p>


<br>
<h3>Pie del Chatbot (Input y Botones)</h3>
<p>Esta secci√≥n define el √°rea inferior del chatbot, que permite al usuario escribir y enviar mensajes. Incluye un campo de entrada de texto y un bot√≥n de env√≠o estilizado.</p>
<pre><code class="language-css">
.chatbot-footer {
  padding: 10px;
  border-top: 1px solid #eee;
  display: flex;
  gap: 5px;
}

.chatbot-input-field {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 20px;
  outline: none;
  transition: none !important;
}

.chatbot-send {
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
}
</code></pre>
<p>Este pie de conversaci√≥n proporciona una experiencia de usuario clara y accesible, combinando dise√±o limpio y funcionalidad esencial para facilitar el env√≠o de mensajes en el chatbot.</p><br>

<br>
<h3>Bot√≥n Toggle (Abrir/Cerrar Chatbot)</h3>
<p>Esta secci√≥n define el bot√≥n flotante que permite al usuario abrir o cerrar la interfaz del chatbot. Su dise√±o circular y color llamativo aseguran una visibilidad √≥ptima sin interferir con el contenido principal de la p√°gina.</p>
<pre><code class="language-css">
.chatbot-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(to right, #235ee8, #4d80ee);
  color: white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  z-index: 999;
}

.chatbot-toggle svg {
  fill: #bd04f5;
}
</code></pre>
<p>Este bot√≥n de toggle es esencial para brindar una experiencia accesible y moderna, permitiendo que el usuario controle f√°cilmente la visibilidad del chatbot desde cualquier lugar de la pantalla.</p>


<br>
<h3>Efecto Hover en Im√°genes</h3>
<p>Esta secci√≥n proporciona una animaci√≥n visual sutil pero efectiva para im√°genes dentro del chatbot (o cualquier secci√≥n del sitio) al aplicar un efecto de zoom al pasar el cursor.</p>
<pre><code class="language-css">
.img-zoom {
  transition: transform 0.3s ease;
  cursor: pointer;
}

.img-zoom:hover {
  transform: scale(1.1);
}
</code></pre>
<p>Este efecto mejora la experiencia de usuario al hacer que las im√°genes sean m√°s din√°micas e interactivas, ideal para miniaturas, respuestas visuales del chatbot o elementos gr√°ficos destacados.</p>


<br>
<h3>Bot√≥n de Limpiar Historial</h3>
<p>Esta secci√≥n define los estilos visuales del bot√≥n que permite al usuario eliminar el historial del chat, proporcionando una acci√≥n clara y destacada.</p>
<pre><code class="language-css">
.clear-history-btn {
  background: red;
  color: rgb(255, 255, 255);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 25px;
  cursor: pointer;
  margin-right: auto;
  font-size: 1rem;
}
</code></pre>
<p>Este bot√≥n debe ser utilizado con precauci√≥n y estar claramente identificado, ya que est√° asociado a la eliminaci√≥n de datos. Puede incluirse un √≠cono de papelera o texto como ‚ÄúüóëÔ∏è‚Äù para reforzar su funci√≥n.</p>


<br>
<h3>Estilos Avanzados de Texto</h3>
<p>Esta secci√≥n proporciona formateo enriquecido para el contenido textual de los mensajes, permitiendo que los mensajes del chatbot incluyan t√≠tulos, listas, bloques de c√≥digo, citas y enlaces de forma legible y elegante.</p>
<pre><code class="language-css">
.message-content {
  word-wrap: break-word;
}

.message-content p {
  margin: 0;
}

.message-content {
  line-height: 1.5;
  word-wrap: break-word;
}

.message-content h1,
.message-content h2,
.message-content h3,
.message-content h4,
.message-content h5,
.message-content h6 {
  margin-top: 1em;
  margin-bottom: 0.5em;
  font-weight: bold;
}

.message-content ul,
.message-content ol {
  margin-bottom: 1em;
  padding-left: 2em;
}

.message-content blockquote {
  border-left: 3px solid #ddd;
  padding-left: 1em;
  margin-left: 0;
  color: #777;
}

.message-content pre {
  background: #f5f5f5;
  padding: 1em;
  border-radius: 3px;
  overflow-x: auto;
}

.message-content code {
  background: #f5f5f5;
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-family: monospace;
}

.message-content a {
  color: linear-gradient(to right, #235ee8, #4d80ee);
  text-decoration: none;
}

.message-content a:hover {
  text-decoration: underline;
}
</code></pre>
<p>Estos estilos permiten que los mensajes del chatbot presenten contenido complejo y estructurado de manera profesional, facilitando la lectura y comprensi√≥n por parte del usuario.</p>


<br>
<h3>Responsive Design para Dispositivos M√≥viles</h3>
<p>Esta secci√≥n adapta la interfaz del chatbot para ofrecer una experiencia √≥ptima en pantallas peque√±as, como smartphones o tablets. El dise√±o se ajusta autom√°ticamente cuando el ancho de la pantalla es de 768 p√≠xeles o menos.</p>
<pre><code class="language-css">
@media (max-width: 768px) {
  #chatbot-container {
    width: 95vw !important;
    height: 80vh !important;
    max-height: 80vh !important;
    right: 2.5vw !important;
    bottom: 10px !important;
    left: auto !important;
    border-radius: 10px !important;
  }

  .chatbot-messages {
    padding: 10px 8px !important;
  }

  .user-message,
  .bot-message {
    max-width: 90% !important;
    padding: 8px 12px !important;
    font-size: 14px !important;
  }

  .chatbot-toggle {
    width: 50px !important;
    height: 50px !important;
    bottom: 10px !important;
    right: 10px !important;
  }

  .chatbot-input-field {
    padding: 8px 12px !important;
    font-size: 14px !important;
  }

  .chatbot-send {
    width: 36px !important;
    height: 36px !important;
  }

  .chatbot-header span {
    font-size: 16px !important;
  }
}
</code></pre>
<p>Con estos estilos, el chatbot mantiene usabilidad, est√©tica y funcionalidad en dispositivos m√≥viles, proporcionando una experiencia fluida sin importar el tama√±o de pantalla.</p>

        </section>


<!-- Guia JS-->
<section id="js-guia" class="doc-section">
  <h2><i class="fab fa-js-square"></i> Gu√≠a JavaScript</h2>
  <p>
  El archivo JavaScript proporcionado implementa la l√≥gica interactiva para un chatbot en el frontend. A continuaci√≥n, se presenta una explicaci√≥n detallada de las principales secciones del c√≥digo:
  </p>
<h3>Objeto Principal del Chatbot</h3>
<p>Este bloque define la estructura base y el estado del chatbot a trav√©s de un objeto principal llamado chatbot. Este patr√≥n modular permite gestionar el comportamiento, la l√≥gica y la interacci√≥n del chatbot de manera centralizada y ordenada.</p>
<pre><code class="language-js">
const chatbot = {
  elements: {
    toggle: document.getElementById("chatbot-toggle"),
    container: document.getElementById("chatbot-container"),
    closeBtn: document.getElementById("chatbot-close"),
    messages: document.getElementById("chatbot-messages"),
    input: document.getElementById("chatbot-input-field"),
    sendBtn: document.getElementById("chatbot-send"),
    clearBtn: document.querySelector(".clear-history-btn"),
  },
  state: {
    isOpen: false,
    isTyping: false,
    currentTypingAnimation: null,
  },
};
</code></pre>
<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Propiedad</th>
      <th>Descripci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>toggle</code></td>
      <td>Bot√≥n flotante para abrir/cerrar el chatbot</td>
    </tr>
    <tr>
      <td><code>container</code></td>
      <td>Contenedor principal del chatbot (<code>#chatbot-container</code>)</td>
    </tr>
    <tr>
      <td><code>closeBtn</code></td>
      <td>Bot√≥n (X) para cerrar el chatbot</td>
    </tr>
    <tr>
      <td><code>messages</code></td>
      <td>Contenedor donde se agregan los mensajes (<code>#chatbot-messages</code>)</td>
    </tr>
    <tr>
      <td><code>input</code></td>
      <td>Campo de texto para escribir mensajes</td>
    </tr>
    <tr>
      <td><code>sendBtn</code></td>
      <td>Bot√≥n para enviar el mensaje (<code>#chatbot-send</code>)</td>
    </tr>
    <tr>
      <td><code>clearBtn</code></td>
      <td>Bot√≥n para borrar el historial de mensajes (<code>.clear-history-btn</code>)</td>
    </tr>
  </tbody>
</table>
<p>Estas referencias permiten acceder r√°pidamente a cada componente sin hacer m√∫ltiples consultas DOM repetitivas.</p>   

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Propiedad</th>
      <th>Tipo</th>
      <th>Funci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>isOpen</code></td>
      <td><code>boolean</code></td>
      <td>Indica si el chatbot est√° abierto o cerrado</td>
    </tr>
    <tr>
      <td><code>isTyping</code></td>
      <td><code>boolean</code></td>
      <td>Indica si el bot est√° "escribiendo" (usado para animaci√≥n o retardo)</td>
    </tr>
    <tr>
      <td><code>currentTypingAnimation</code></td>
      <td><code>number</code>/<code>null</code></td>
      <td>ID de la animaci√≥n en curso (puede ser usada para cancelarla)</td>
    </tr>
  </tbody>
</table>

<p>Este dise√±o orientado a objetos facilita una arquitectura modular, legible y escalable, permitiendo manejar f√°cilmente la interacci√≥n del usuario, el control de flujo y la manipulaci√≥n din√°mica del DOM.</p>   

<h3>Elementos y l√≥gica adicional de la interfaz</h3>
<pre><code class="language-js">
// Elementos adicionales de la UI
const chatbotToggle = document.getElementById("chatbot-toggle");
const chatbotInvite = document.getElementById("chatbot-invite");

// Mostrar mensaje de invitaci√≥n al pasar el mouse
chatbotToggle.addEventListener("mouseenter", () => {
  chatbotInvite.classList.add("visible");
});

// Ocultar mensaje de invitaci√≥n al quitar el mouse
chatbotToggle.addEventListener("mouseleave", () => {
  chatbotInvite.classList.remove("visible");
});

// Mostrar mensaje de invitaci√≥n temporal al cargar la p√°gina
setTimeout(() => {
  chatbotInvite.classList.add("visible");
  setTimeout(() => {
    chatbotInvite.classList.remove("visible");
  }, 3000); // Ocultar despu√©s de 3 segundos
}, 1000); // Mostrar 1 segundo despu√©s de cargar

// Configuraci√≥n de marked.js para procesar Markdown
marked.setOptions({
  breaks: true, // Convertir saltos de l√≠nea en <br>
  gfm: true, // Soporte para GitHub Flavored Markdown
  smartypants: true, // Conversi√≥n inteligente de comillas y guiones

  /**
    * Funci√≥n para resaltado de sintaxis (opcional)
    * @param {string} code - C√≥digo a resaltar
    * @param {string} lang - Lenguaje de programaci√≥n
    * @returns {string} C√≥digo HTML resaltado
    */
  highlight: function (code, lang) {
    // Requiere Prism.js para funcionar
    if (Prism && lang && Prism.languages[lang]) {
      return Prism.highlight(code, Prism.languages[lang], lang);
    }
    return code;
  },
});
</code></pre>
<p>Este bloque de c√≥digo mejora la experiencia del usuario con elementos visuales e integraci√≥n con Markdown:</p>
<div style="margin:1rem">
  <ul>
    <li><code>chatbotToggle</code> y <code>chatbotInvite</code>:</li>
    <p>Se obtienen referencias al bot√≥n flotante del chatbot (#chatbot-toggle) y al mensaje de invitaci√≥n (#chatbot-invite), que es un peque√±o texto emergente que sugiere al usuario iniciar una conversaci√≥n.</p>
    <li>Eventos de interacci√≥n (<code>hover</code>):</li>
    <ul style="margin-left: 20px;">
      <li>Al pasar el mouse sobre el bot√≥n (<code>mouseenter</code>), se a√±ade la clase .visible al elemento de invitaci√≥n, mostr√°ndolo.</li>
      <li>Al retirar el mouse (<code>mouseleave</code>), se elimina dicha clase, ocultando el mensaje.</li>
    </ul>
    <li>Invitaci√≥n autom√°tica al cargar la p√°gina:</li>
    <p>Se programa un setTimeout que, 1 segundo despu√©s de cargar la p√°gina, muestra el mensaje de invitaci√≥n autom√°ticamente durante 3 segundos, para captar la atenci√≥n del usuario sin requerir interacci√≥n.</p>
  </ul>
</div>

<h3>Configuraci√≥n de marked.js</h3>
<p>Se personaliza la librer√≠a marked.js para interpretar correctamente Markdown en los mensajes:</p>
<div style="margin:1rem">
  <ul>
    <li><code>breaks: true</code> :Convierte saltos de l√≠nea simples (<code>\n</code>) en saltos de l√≠nea HTML (<code>&lt;br&gt</code>).</li>
    <li><code>gfm: true</code>: Activa el soporte para GitHub Flavored Markdown (tablas, listas mejoradas, etc.).</li>
    <li><code>smartypants: true</code>: Mejora tipogr√°ficamente los mensajes, transformando comillas rectas en comillas tipogr√°ficas y guiones en rayas.</li>
  </ul>
</div>
<p>Adem√°s, se define una funci√≥n de resaltado de sintaxis para bloques de c√≥digo (highlight), que utiliza Prism.js si est√° disponible. Esto permite mostrar fragmentos de c√≥digo con colores adecuados al lenguaje, mejorando la legibilidad.</p>


<br>
<h3>Funci√≥n: <code>showMessageWithTyping(content, sender, index = null)</code></h3>
<p>Esta funci√≥n muestra un mensaje en pantalla simulando un efecto de escritura animada, similar al de los asistentes virtuales modernos.</p>
<pre><code class="language-js">
async function showMessageWithTyping(content, sender, index = null) {
  return new Promise((resolve) => {
    // Cancelar animaci√≥n anterior si existe
    if (chatbot.state.currentTypingAnimation) {
      clearTimeout(chatbot.state.currentTypingAnimation);
    }

    // Crear elemento del mensaje
    const messageDiv = document.createElement("div");
    messageDiv.className = `${sender}-message`;
    if (index !== null) messageDiv.dataset.index = index;

    const contentDiv = document.createElement("div");
    contentDiv.className = "message-content";
    messageDiv.appendChild(contentDiv);

    // A√±adir al contenedor de mensajes
    chatbot.elements.messages.appendChild(messageDiv);

    let i = 0;
    const speed = 20; // Velocidad de escritura en ms por caracter
    const fullText = content;
    let htmlBuffer = "";

    // Funci√≥n recursiva para el efecto de escritura
    function typeWriter() {
      if (i < fullText.length) {
        htmlBuffer += fullText.charAt(i);
        i++;
        // Procesar Markdown a medida que se escribe
        contentDiv.innerHTML = marked.parse(htmlBuffer);
        scrollToBottom();
        chatbot.state.currentTypingAnimation = setTimeout(typeWriter, speed);
      } else {
        chatbot.state.currentTypingAnimation = null;
        resolve();
      }
    }

    typeWriter();
  });
}
</code></pre>
<h4>L√≥gica y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Control de animaci√≥n activa:</b></li>
    <ul style="margin-left: 20px;">
      <li>Si ya hay una animaci√≥n de escritura en curso (<code>chatbot.state.currentTypingAnimation</code>), se detiene con <code>clearTimeout</code> para evitar superposiciones.</li>
    </ul>
    <li><b>Creaci√≥n del mensaje en el DOM:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se construye un div con clase din√°mica seg√∫n el remitente (<code>user-message, assistant-message</code>, etc.).</li>
      <li>Dentro se a√±ade otro div para el contenido (<code>.message-content</code>).</li>
      <li>Se inserta en el contenedor de mensajes del chatbot.</li>
    </ul>
    <li><b>Animaci√≥n de escritura:</b></li>
    <ul style="margin-left: 20px;">
      <li>Caracter por caracter, el texto va apareciendo simulando una m√°quina de escribir.</li>
      <li>Se usa <code>marked.parse()</code> para procesar y renderizar Markdown a medida que el mensaje se escribe.</li>
    </ul>
    <li><b>Desplazamiento autom√°tico:</b></li>
    <ul style="margin-left: 20px;">
      <li>Con cada car√°cter, se asegura que el scroll baje al final con <code>scrollToBottom()</code>.</li>
    </ul>
    <li><b>Resoluci√≥n de la promesa:</b></li>
    <ul style="margin-left: 20px;">
      <li>La funci√≥n se completa (<code>resolve()</code>) una vez que el mensaje se ha mostrado completamente.</li>
    </ul>
  </ol>
</div>
<p>Esta funci√≥n mejora significativamente la experiencia de usuario, generando una sensaci√≥n de conversaci√≥n realista, progresiva y visualmente atractiva.</p>

<br>
<h3>Funci√≥n: <code>showMessageInstant(content, sender, index = null)</code></h3>
<p>Esta funci√≥n muestra un mensaje en el chat de forma inmediata, sin aplicar efectos de escritura animada.</p>
<pre><code class="language-js">
function showMessageInstant(content, sender, index = null) {
  const messageDiv = document.createElement("div");
  messageDiv.className = `${sender}-message`;
  if (index !== null) messageDiv.dataset.index = index;

  const contentDiv = document.createElement("div");
  contentDiv.className = "message-content";
  // Procesar Markdown
  contentDiv.innerHTML = marked.parse(content);
  messageDiv.appendChild(contentDiv);

  chatbot.elements.messages.appendChild(messageDiv);

  scrollToBottom();
}
</code></pre>
<h4>L√≥gica y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Construcci√≥n del mensaje:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se crea un elemento <code>div</code> con clase dependiente del emisor (por ejemplo: <code>user-message</code> o <code>assistant-message</code>).</li>
      <li>Si se proporciona un index, se asigna como atributo data-index.</li>
    </ul>
    <li><b>Procesamiento de contenido:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se crea un contenedor interno <code>.message-content</code>.</li>
      <li>El contenido se convierte a HTML usando <code>marked.parse()</code>, lo que permite usar Markdown.</li>
    </ul>
    <li><b>Inserci√≥n en el DOM:</b></li>
    <ul style="margin-left: 20px;">
      <li>El mensaje se agrega directamente al contenedor de mensajes del chatbot.</li>
    </ul>
    <li><b>Auto scroll:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se asegura que la vista se desplace al √∫ltimo mensaje con <code>scrollToBottom()</code>.</li>
    </ul>
  </ol>
</div>

<h3>Funci√≥n: <code>sanitizeUserInput(input)</code></h3>
<p>Esta funci√≥n sanitiza la entrada del usuario con el fin de prevenir ataques XSS (<code>Cross-Site Scripting</code>) eliminando c√≥digo potencialmente peligroso.</p>
<pre><code class="language-js">
function sanitizeUserInput(input) {
    // Eliminar scripts y atributos de eventos peligrosos
    return input
      .replace(/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi, "")
      .replace(/on\w+="[^"]*"/g, "");
}
</code></pre>
<h4>L√≥gica y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Elimina etiquetas <code>&lt;script&gt;</code> completas:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se usa una expresi√≥n regular que detecta bloques <code>&lt;script&gt;...&lt;/script&gt;</code> (incluyendo contenido anidado o multilineal).</li>
      <li>Se remueven completamente para evitar ejecuci√≥n de c√≥digo malicioso.</li>
    </ul>
    <li><b>Elimina atributos de eventos peligrosos:</b></li>
    <ul style="margin-left: 20px;">
      <li>Como <code> onclick="...", onmouseover="..."</code>, etc.</li>
      <li>Se detectan con <code>on\w+="..."</code> y se eliminan del texto.</li>
    </ul>
  </ol>
</div>


<h3>Funci√≥n: <code>sendMessage()</code></h3>
<p>Esta funci√≥n asincr√≥nica se encarga de enviar el mensaje del usuario al servidor, mostrarlo en pantalla, gestionar la interfaz de "<code>el bot est√° escribiendo</code>", y luego mostrar la respuesta del bot con animaci√≥n de escritura.</p>
<pre><code class="language-js">
async function sendMessage() {
  let message = chatbot.elements.input.value.trim();
  // No hacer nada si el campo est√° vac√≠o o el bot est√° escribiendo
  if (!message || chatbot.state.isTyping) return;

  try {
    // Sanitizar el mensaje del usuario
    message = sanitizeUserInput(message);

    // Mostrar mensaje del usuario inmediatamente
    showMessageInstant(message, "user");
    chatbot.elements.input.value = "";
    chatbot.state.isTyping = true;

    // Mostrar indicador de que el bot est√° escribiendo
    const typingIndicator = createTypingIndicator();
    chatbot.elements.messages.appendChild(typingIndicator);
    scrollToBottom();

    // Enviar mensaje al servidor
    const response = await fetch("chatbot/chatbot.php", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: `action=send_message&message=${encodeURIComponent(message)}`,
    });

    // Verificar si la respuesta es v√°lida
    if (!response.ok) {
      throw new Error(`Error HTTP! estado: ${response.status}`);
    }

    const data = await response.json();
    // Eliminar indicador de escritura
    chatbot.elements.messages.removeChild(typingIndicator);

    if (!data.success) {
      throw new Error(data.error || "Error en la respuesta del servidor");
    }

    // Mostrar respuesta con efecto de escritura
    await showMessageWithTyping(data.response, "assistant");
  } catch (error) {
    console.error("Error enviando mensaje:", error);
    showMessageInstant(
      "Error al procesar tu mensaje. Intenta nuevamente.",
      "system"
    );
  } finally {
    chatbot.state.isTyping = false;
  }
}
</code></pre>
<h4>L√≥gica y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Lectura y validaci√≥n del mensaje:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se obtiene el texto desde el campo de entrada.</li>
      <li>Si el mensaje est√° vac√≠o o el bot ya est√° escribiendo (<code>isTyping = true</code>), no hace nada.</li>
    </ul>
    <li><b>Sanitizaci√≥n del mensaje:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se limpia el contenido usando <code>sanitizeUserInput()</code> para evitar c√≥digo malicioso.</li>
    </ul>
    <li><b>Muestra inmediata del mensaje del usuario:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se llama a <code>showMessageInstant()</code> para mostrar lo que el usuario escribi√≥.</li>
    </ul>
    <li><b>Env√≠o del mensaje al servidor:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se hace un fetch() a <code>chatbot/chatbot.php</code> usando <code>POST</code>.</li>
      <li>Se env√≠a el mensaje codificado en formato URL.</li>
    </ul>
    <li><b>Procesamiento de la respuesta:</b></li>
    <ul style="margin-left: 20px;">
      <li>Si la respuesta <code>HTTP</code> no es v√°lida, lanza un error.</li>
      <li>Si <code>data.success</code> es <code>false</code>, tambi√©n lanza error con el mensaje recibido.</li>
      <li>Si todo est√° bien, elimina el indicador y muestra la respuesta del bot usando <code>showMessageWithTyping()</code>.</li>
    </ul>
    <li><b>Manejo de errores:</b></li>
    <ul style="margin-left: 20px;">
      <li>Cualquier error del proceso muestra un mensaje tipo <code>system</code> indicando que ocurri√≥ un problema.</li>
    </ul>
    <li><b>Restablecimiento del estado:</b></li>
    <ul style="margin-left: 20px;">
      <li>Independientemente del resultado, la variable <code>isTyping</code> se restablece a <code>false</code>.</li>
    </ul>
  </ol>
</div>

<br>
<h3>Funci√≥n: <code>loadChatHistory()</code></h3>
<p>Esta funci√≥n asincr√≥nica se encarga de cargar y mostrar el historial completo de la conversaci√≥n desde el servidor. Si no hay historial, muestra un mensaje de bienvenida del asistente.</p>
<pre><code class="language-js">
async function loadChatHistory() {
  try {
    const response = await fetch("chatbot/chatbot.php", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: "action=load_history",
    });

    const data = await response.json();

    if (!data.success) {
      throw new Error(data.error || "Error cargando historial");
    }

    // Limpiar contenedor de mensajes
    chatbot.elements.messages.innerHTML = "";

    if (data.history && data.history.length > 0) {
      // Mostrar cada mensaje del historial
      for (let i = 0; i < data.history.length; i++) {
        const msg = data.history[i];
        showMessageInstant(
          msg.content,
          msg.role === "user" ? "user" : "assistant",
          i
        );
      }
    } else {
      // Mostrar mensaje de bienvenida si no hay historial
      showMessageInstant("¬°Hola! ¬øEn qu√© puedo ayudarte? üòä", "assistant");
    }
  } catch (error) {
    console.error("Error cargando historial:", error);
    showMessageInstant("No se pudo cargar el historial de chat", "system");
  }
}
</code></pre>
<h4>Flujo y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Solicitud al servidor:</b></li>
    <ul style="margin-left: 20px;">
      <li>Env√≠a una petici√≥n <code>POST</code> a <code>chatbot/chatbot.php</code> con el par√°metro <code>action=load_history</code>.</li>
      <li>Si el mensaje est√° vac√≠o o el bot ya est√° escribiendo (<code>isTyping = true</code>), no hace nada.</li>
    </ul>
    <li><b>Procesamiento de la respuesta:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se convierte la respuesta a <code>JSON</code>.</li>
      <li>Si <code>data.success</code> es <code>false</code>, lanza un error.</li>
    </ul>
    <li><b>Limpieza del √°rea de mensajes:</b></li>
    <ul style="margin-left: 20px;">
      <li>Borra cualquier contenido anterior del contenedor de mensajes (<code>chatbot.elements.messages.innerHTML = ""</code>).</li>
    </ul>
    <li><b>Cargar historial (si existe):</b></li>
    <ul style="margin-left: 20px;">
      <li>Si <code>data.history</code> es un array v√°lido y con contenido, recorre cada mensaje.</li>
      <li>Usa <code>showMessageInstant()</code> para renderizar cada mensaje.</li>
      <li>Determina el remitente (<code>user o assistant</code>) seg√∫n el campo role.</li>
    </ul>
    <li><b>Mostrar mensaje de bienvenida (si no hay historial):</b></li>
    <ul style="margin-left: 20px;">
      <li>Si no hay mensajes, muestra el <code>mensaje: "¬°Hola! ¬øEn qu√© puedo ayudarte? üòä"</code> como remitente <code>assistant</code>.</li>
    </ul>
    <li><b>Manejo de errores:</b></li>
    <ul style="margin-left: 20px;">
      <li>Si ocurre alg√∫n error en la petici√≥n o el procesamiento, muestra un mensaje tipo <code>system: "No se pudo cargar el historial de chat"</code>.</li>
    </ul>
  </ol>
</div>

<br>
<h3>Funci√≥n: <code>createTypingIndicator()</code></h3>
<p>Esta funci√≥n crea y devuelve un indicador visual animado que representa que el asistente est√° escribiendo, imitando el t√≠pico efecto de "tres puntos en movimiento".</p>
<pre><code class="language-js">
function createTypingIndicator() {
  const indicator = document.createElement("div");
  indicator.className = "typing-indicator";

  // A√±adir puntos de animaci√≥n
  for (let i = 0; i < 3; i++) {
    const dot = document.createElement("span");
    dot.className = "typing-dot";
    indicator.appendChild(dot);
  }

  return indicator;
}
</code></pre>
<h4>Flujo y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Crear contenedor principal:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se genera un <div> con clase CSS <code>typing-indicator</code>.</li>
    </ul>
    <li><b>A√±adir puntos animados:</b></li>
    <ul style="margin-left: 20px;">
      <li>Se crean tres <span> con clase <code>typing-dot</code> que se a√±aden al contenedor.</li>
      <li>Estos puntos pueden ser estilizados con CSS para generar la animaci√≥n de escritura (por ejemplo: aparici√≥n secuencial, parpadeo o movimiento).</li>
    </ul>
    <li><b>Retornar el indicador:</b></li>
    <ul style="margin-left: 20px;">
      <li>La funci√≥n devuelve el elemento HTML completo (<div> con los tres <span> dentro) para ser insertado en el DOM.</li>
    </ul>
  </ol>
</div>
<p>Esta funci√≥n suele ser utilizada en <code>sendMessage()</code> para indicar que el bot est√° "pensando" o generando una respuesta antes de que esta aparezca con el efecto de tipeo.</p>


<br>
<h3>Funci√≥n: <code>scrollToBottom()</code></h3>
<p>Esta funci√≥n desplaza autom√°ticamente el √°rea de mensajes hacia el final, asegurando que el mensaje m√°s reciente (o indicador de escritura) siempre sea visible para el usuario.</p>
<pre><code class="language-js">
function scrollToBottom() {
  chatbot.elements.messages.scrollTop =
    chatbot.elements.messages.scrollHeight;
}
</code></pre>
<h4>Flujo y comportamiento:</h4>
<div style="margin:1rem">
  <ol>
    <li><b>Acceso al contenedor de mensajes:</b></li>
    <ul style="margin-left: 20px;">
      <li>Usa <code>chatbot.elements.messages</code>, que representa el √°rea que contiene todos los mensajes del chat.</li>
    </ul>
    <li><b>Ajuste del desplazamiento:</b></li>
    <ul style="margin-left: 20px;">
      <li>Establece <code>scrollTop</code> igual a <code>scrollHeight</code>, lo cual mueve la vista al fondo del contenedor.</li>
    </ul>
  </ol>
</div>
<p>Se llama despu√©s de agregar un mensaje (por ejemplo, en showMessageWithTyping, showMessageInstant, o al crear el indicador de escritura) para mantener la conversaci√≥n visible sin intervenci√≥n del usuario.
</p>


<br>
<h3>Fragmento: Alternar visibilidad del chat</h3>
<p>Este bloque de c√≥digo controla la apertura y cierre del chat cuando el usuario hace clic en el bot√≥n de alternar (<code>chatbot.elements.toggle</code>).</p>
<pre><code class="language-js">
// Alternar visibilidad del chat
chatbot.elements.toggle.addEventListener("click", () => {
  chatbot.state.isOpen = !chatbot.state.isOpen;
  chatbot.elements.container.classList.toggle(
    "hidden",
    !chatbot.state.isOpen
  );
  if (chatbot.state.isOpen) scrollToBottom();
});
</code></pre>
<h4>¬øQu√© hace?</h4>
<div style="margin:1rem">
  <ul>
    <li>Escucha el evento click en el bot√≥n de alternar del chatbot.</li>
    <li>Cambia el estado del chat (<code>chatbot.state.isOpen</code>) entre true y false.</li>
    <li>Alterna la clase hidden en el contenedor del chat para mostrarlo u ocultarlo visualmente.</li>
    <li>Si el chat se abre, se hace scroll autom√°tico hacia el √∫ltimo mensaje con <code>scrollToBottom()</code>.</li>
  </ul>
</div>
<p>Se llama despu√©s de agregar un mensaje (por ejemplo, en <code>showMessageWithTyping, showMessageInstant</code>, o al crear el indicador de escritura) para mantener la conversaci√≥n visible sin intervenci√≥n del usuario.
</p>

<br>
<h3>Fragmento: Cerrar el chat</h3>
<p>Este bloque se encarga de cerrar completamente la ventana del chatbot cuando el usuario hace clic en el bot√≥n de cerrar (<code>closeBtn</code>).</p>
<pre><code class="language-js">
 // Cerrar el chat
chatbot.elements.closeBtn.addEventListener("click", () => {
  chatbot.state.isOpen = false;
  chatbot.elements.container.classList.add("hidden");
});
</code></pre>
<h4>¬øQu√© hace?</h4>
<div style="margin:1rem">
  <ul>
    <li>Escucha el evento click en el bot√≥n de cerrar.</li>
    <li>Cambia el estado del chatbot (chatbot.state.isOpen) a false.</li>
    <li>A√±ade la clase hidden al contenedor del chat, ocult√°ndolo de la vista.</li>
  </ul>
</div>

<br>
<h3>Fragmento: Enviar mensaje al presionar Enter</h3>
<p>Este bloque permite al usuario enviar un mensaje presionando la tecla Enter, igual que en muchos chats o apps de mensajer√≠a.</p>
<pre><code class="language-js">
// Enviar mensaje al presionar Enter
chatbot.elements.input.addEventListener("keypress", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
</code></pre>
<h4>¬øQu√© hace?</h4>
<div style="margin:1rem">
  <ul>
    <li>Escucha la tecla presionada dentro del campo de entrada (input).</li>
    <li>Si se presiona Enter sin la tecla Shift, evita el comportamiento por defecto (como un salto de l√≠nea) y llama a sendMessage().</li>
  </ul>
</div>

<br>
<h3>Fragmento: Enviar mensaje al hacer clic en el bot√≥n</h3>
<p>Este bloque permite enviar un mensaje del usuario al hacer clic en el bot√≥n de enviar (√≠cono de avi√≥n o similar).</p>
<pre><code class="language-js">
// Enviar mensaje al hacer clic en el bot√≥n
chatbot.elements.sendBtn.addEventListener("click", sendMessage);
</code></pre>
<h4>¬øQu√© hace?</h4>
<div style="margin:1rem">
  <ul>
    <li>Escucha el evento click sobre el bot√≥n de enviar (<code>sendBtn</code>).</li>
    <li>Llama a la funci√≥n <code>sendMessage()</code> que se encarga de procesar y mostrar el mensaje del usuario y la respuesta del asistente.</li>
  </ul>
</div>
<p>Con este fragmento, el usuario puede enviar mensajes no solo con la tecla Enter, sino tambi√©n haciendo clic en el bot√≥n de enviar.</p>

<br>
<h3>Fragmento: Limpiar todo el historial de chat</h3>
<p>Este bloque permite al usuario borrar todos los mensajes del historial al hacer clic en un bot√≥n.</p>
<pre><code class="language-js">
// Limpiar todo el historial de chat
chatbot.elements.clearBtn.addEventListener("click", async () => {
  try {
    const response = await fetch("chatbot/chatbot.php", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: "action=clear_history",
    });

    const data = await response.json();

    if (!data.success) {
      throw new Error(data.error || "Error al limpiar historial");
    }

    // Vaciar el contenedor de mensajes
    chatbot.elements.messages.innerHTML = "";
  } catch (error) {
    console.error("Error limpiando historial:", error);
    showMessageInstant("No se pudo limpiar el historial", "system");
  }
});
</code></pre>
<h4>¬øQu√© hace?</h4>
<div style="margin:1rem">
  <ul>
    <li>Escucha el clic en el bot√≥n de "Limpiar historial".</li>
    <li>Env√≠a una petici√≥n <code>POST</code> al servidor con la acci√≥n clear_history.</li>
    <li>Si el servidor responde con √©xito:</li>
    <ul style="margin-left:1rem">
      <li>Vac√≠a el contenido del contenedor de mensajes (<code>chatbot.elements.messages.innerHTML = ""</code>).</li>
    </ul>
    <li>Si ocurre un error</li>
    <ul style="margin-left:1rem">
      <li>Muestra un mensaje de sistema indicando el fallo.</li>
    </ul>
  </ul>
</div>

<h4>Resultado</h4>
<div style="margin:1rem">
  <ul>
    <li>El historial de mensajes se borra del servidor y de la interfaz.</li>
    <li>Si hay un problema (como un fallo del servidor), el usuario ve un mensaje de error.</li>
  </ul>
</div>

<br>
<h3>Flujo General del Chatbot</h3>
<pre><code class="language-plaintext">
[Usuario escribe mensaje]
        |
        v
 [input textarea] <---- escucha tecla "Enter" o clic en bot√≥n enviar
        |
        v
 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ    sanitizeUserInput()      ‚îÇ ‚Üê Elimina scripts peligrosos
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        |
        v
 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ   showMessageInstant()      ‚îÇ ‚Üê Muestra mensaje del usuario
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        |
        v
 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ  createTypingIndicator()    ‚îÇ ‚Üê Muestra indicador "escribiendo..."
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        |
        v
 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ     fetch (chatbot.php)     ‚îÇ ‚Üê Envia mensaje al servidor
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        |
        v
[ Respuesta JSON: { success, response } ]
        |
        v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  showMessageWithTyping(response)     ‚îÇ ‚Üê Muestra respuesta del bot
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        |
        v
 [scrollToBottom()] ‚Üê asegura que el √∫ltimo mensaje sea visible

</code></pre>

</section>

 <section id="soporte" class="doc-section">
  <h2><i class="fas fa-life-ring"></i> Soporte y Soluci√≥n de Problemas</h2>

  <h3>Errores Comunes y Soluciones</h3>

  <div class="feature-card">
    <h4><i class="fas fa-exclamation-triangle"></i> El chatbot no responde</h4>
    <p><strong>Posibles causas:</strong></p>
    <div style="margin:1rem">
      <ul>
      <li>La clave de la API en el archivo <code>.env</code> es incorrecta o est√° vac√≠a.</li>
      <li>El servidor no permite conexiones salientes (cURL deshabilitado).</li>
      <li>Se est√°n generando errores en el backend (verifica el log de errores de PHP).</li>
    </ul>
    </div>
    
    <p><strong>Soluci√≥n sugerida:</strong> Verifica los puntos anteriores y aseg√∫rate de que tu servidor cumpla con los requisitos m√≠nimos.</p>
  </div>

  <div class="feature-card">
    <h4><i class="fas fa-exclamation-triangle"></i> Los mensajes no se guardan</h4>
    <p><strong>Posibles causas:</strong></p>
    <div style="margin:1rem">
    <ul>
      <li>Las sesiones de PHP no est√°n habilitadas o configuradas correctamente.</li>
      <li>Faltan permisos de escritura en el directorio donde se almacenan los datos.</li>
      <li>Errores JavaScript est√°n interfiriendo con la funcionalidad (revisa la consola del navegador).</li>
    </ul>
    </div>
    <p><strong>Soluci√≥n sugerida:</strong> Comprueba la configuraci√≥n del servidor, permisos de archivos y errores en el navegador.</p>
  </div>

  <h3>¬øNecesitas ayuda?</h3>
  <p>Si no puedes resolver un problema, puedes contactar a nuestro equipo de soporte t√©cnico:</p>
  <div style="margin:1rem">
  <ul>
    <li><strong>Email:</strong> <a href="mailto:support@linkve.net">support@linkve.net</a></li>
    <li><strong>Sitio web:</strong> <a href="https://www.linkve.net/contactus" target="_blank">https://www.linkve.net/contactus</a></li>
  </ul>
  </div>
  <div class="nota-importante">
    <h4>üìå Informaci√≥n que debes incluir al solicitar soporte:</h4>
    <div style="margin:1rem">
    <ul>
      <li>Versi√≥n del chatbot instalada.</li>
      <li>Descripci√≥n detallada del problema.</li>
      <li>Capturas de pantalla (si aplica).</li>
      <li>Mensajes de error (en consola o logs del servidor).</li>
    </ul>
    </div>
  </div>
</section>

</main>
</div>

<script src="js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
